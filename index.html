<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="博客 前端 前端开发">
<meta property="og:type" content="website">
<meta property="og:title" content="乌斯怀亚-世界以南">
<meta property="og:url" content="http://ifun.work/index.html">
<meta property="og:site_name" content="乌斯怀亚-世界以南">
<meta property="og:description" content="博客 前端 前端开发">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="乌斯怀亚-世界以南">
<meta name="twitter:description" content="博客 前端 前端开发">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ifun.work/"/>





  <title>乌斯怀亚-世界以南</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">乌斯怀亚-世界以南</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">weihome的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/06/04/JS点滴：原型与原型链/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/04/JS点滴：原型与原型链/" itemprop="url">JS点滴：原型与原型链</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-04T10:56:17+08:00">
                2017-06-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一-普通对象与函数对象"><a href="#一-普通对象与函数对象" class="headerlink" title="一. 普通对象与函数对象"></a>一. 普通对象与函数对象</h3><p>JavaScript 中，万物皆对象！但对象也是有区别的。分为普通对象和函数对象，Object 、Function 是 JS 自带的函数对象。下面举例说明</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o1 = &#123;&#125;; </span><br><span class="line"><span class="keyword">var</span> o2 =<span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"><span class="keyword">var</span> o3 = <span class="keyword">new</span> f1();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;&#125;; </span><br><span class="line"><span class="keyword">var</span> f2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> f3 = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'str'</span>,<span class="string">'console.log(str)'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Object</span>); <span class="comment">//function </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Function</span>); <span class="comment">//function  </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f1); <span class="comment">//function </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f2); <span class="comment">//function </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> f3); <span class="comment">//function   </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> o1); <span class="comment">//object </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> o2); <span class="comment">//object </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> o3); <span class="comment">//object</span></span><br></pre></td></tr></table></figure>
<p>在上面的例子中 o1 o2 o3 为普通对象，f1 f2 f3 为函数对象。怎么区分，其实很简单，凡是通过 <strong>new Function()</strong> 创建的对象都是函数对象，其他的都是普通对象。f1,f2,归根结底都是通过 <strong>new Function()</strong> 的方式进行创建的。Function Object 也都是通过 <strong>New Function()</strong> 创建的。</p>
<h3 id="二-构造函数"><a href="#二-构造函数" class="headerlink" title="二. 构造函数"></a>二. 构造函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, age, job</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.name = name;</span><br><span class="line"> <span class="keyword">this</span>.age = age;</span><br><span class="line"> <span class="keyword">this</span>.job = job;</span><br><span class="line"> <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; alert(<span class="keyword">this</span>.name) &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(<span class="string">'Jack'</span>, <span class="number">28</span>, <span class="string">'Software Engineer'</span>);</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(<span class="string">'Mick'</span>, <span class="number">23</span>, <span class="string">'Doctor'</span>);</span><br></pre></td></tr></table></figure>
<p>上面的例子中 <em>person1</em> 和 <em>person2</em> 都是 <code>Person</code> 的实例。这两个实例都有一个 <code>constructor</code> （构造函数）属性，该属性（是一个指针）指向 <code>Person</code>。 即：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(person1.constructor == Person); <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(person2.constructor == Person); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>我们要记住两个概念（构造函数，实例）：<br><code>person1</code> 和 <code>person2</code> 都是 构造函数 <code>Person</code> 的实例<br>一个公式：<br>实例的 <em>构造函数属性（constructor）</em> 指向构造函数。</p>
<h3 id="三-原型对象"><a href="#三-原型对象" class="headerlink" title="三. 原型对象"></a>三. 原型对象</h3><p>在 JavaScript 中，每当定义一个对象（函数也是对象）时候，对象中都会包含一些预定义的属性。其中每个函数对象都有一个 <strong>prototype</strong> 属性，这个属性指向函数的原型对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Person.prototype.name = <span class="string">'xxx'</span>;</span><br><span class="line">Person.prototype.age  = <span class="number">28</span>;</span><br><span class="line">Person.protetype.job  = <span class="string">'Software Engineer'</span>;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.sayName(); <span class="comment">// 'xxx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person();</span><br><span class="line">person2.sayName(); <span class="comment">// 'xxx'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person1.sayname == person2.sayname); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>我们得到了本文第一个「定律」：</p>
<blockquote>
<p>每个对象都有 <strong><strong>proto</strong></strong> 属性，但只有函数对象才有 <strong>prototype</strong> 属性， <strong>原型对象</strong>本身只是一个普通对象（object）.</p>
</blockquote>
<p>在默认情况下，所有的原型对象都会 <strong>自动</strong> 获得一个 <code>constructor（构造函数）</code> 属性，这个属性（是一个指针）指向 prototype 属性所在的函数（Person）.即：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.constructor == Person</span><br></pre></td></tr></table></figure></p>
<p>在上面第二小节《构造函数》里，我们知道实例的构造函数属性（constructor）指向构造函数 ：person1.constructor == Person</p>
<p>这两个「公式」好像有点联系：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person1.constructor == Person</span><br><span class="line">Person.prototype.constructor == Person</span><br></pre></td></tr></table></figure></p>
<p>person1 为什么有 constructor 属性？那是因为 person1 是 Person 的实例。<br>那 Person.prototype 为什么有 constructor 属性？？同理， Person.prototype （你把它想象成 A） 也是Person 的实例。<br>也就是在 Person 创建的时候，创建了一个它的实例对象并赋值给它的 prototype，基本过程如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = <span class="keyword">new</span> Person();</span><br><span class="line">Person.prototype = A;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>结论：<strong>原型对象</strong>（Person.prototype）是 构造函数（Person）创建时自动获得的一个对象，你可以把它当作构造函数一个特殊的实例。</p>
</blockquote>
<p>原型对象其实就是普通对象（但 Function.prototype 除外，它是函数对象，但它很特殊，他没有prototype属性（前面说道函数对象都有prototype属性））。看下面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype) <span class="comment">//Person&#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> Person.prototype) <span class="comment">//Object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Function</span>.prototype) <span class="comment">// Function，这个特殊</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Object</span>.prototype) <span class="comment">// Object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="built_in">Function</span>.prototype.prototype) <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<p> 那原型对象是用来做什么的呢？主要作用是用于继承。举个例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name; <span class="comment">// tip: 当函数执行时这个 this 指的是谁？</span></span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.name;  <span class="comment">// tip: 当函数执行时这个 this 指的是谁？</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> person(<span class="string">'Mick'</span>);</span><br><span class="line">person1.getName(); <span class="comment">//Mick</span></span><br></pre></td></tr></table></figure></p>
<p>从这个例子可以看出，通过给 <code>Person.prototype</code> 设置了一个函数对象的属性，那有 Person 的实例（person1）出来的普通对象就继承了这个属性。具体是怎么实现的继承，就要讲到下面的原型链了。</p>
<p>小问题，上面两个 this 都指向谁？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> person(<span class="string">'Mick'</span>);</span><br><span class="line">person1.name = <span class="string">'Mick'</span>; <span class="comment">// 此时 person1 已经有 name 这个属性了</span></span><br><span class="line">person1.getName(); <span class="comment">//Mick</span></span><br></pre></td></tr></table></figure>
<p>故两次 <strong>this</strong> 在函数执行时都指向 person1。</p>
<h3 id="四-proto"><a href="#四-proto" class="headerlink" title="四. __proto__"></a>四. <strong><code>__proto__</code></strong></h3><p>JS 在创建对象（不论是普通对象还是函数对象）的时候，都有一个叫做 <code>__proto__</code> 的内置属性，用于指向创建它的构造函数的原型对象。<br>对象 person1 有一个 <code>__proto__</code> 属性，创建它的构造函数是 Person，构造函数的原型对象是 Person.prototype ，所以：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person1.__proto__ == Person.prototype</span><br></pre></td></tr></table></figure></p>
<p>请看下图：</p>
<p><img src="http://osjvlsq19.bkt.clouddn.com/js%E5%8E%9F%E5%9E%8B%E9%93%BE.jpg" alt="js原型链"></p>
<p>根据上面这个连接图，我们能得到：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person.prototype.constructor == Person;</span><br><span class="line">person1.__proto__ == Person.prototype;</span><br><span class="line">person1.constructor == Person;</span><br></pre></td></tr></table></figure></p>
<p>不过，要明确的真正重要的一点就是，这个连接存在于 <strong>实例</strong>（person1）与构造函数（Person）的 <strong>原型对象</strong> （Person.prototype）之间，而不是存在于实例（person1）与构造函数（Person）之间。</p>
<p>注意：因为绝大部分浏览器都支持<code>__proto__</code>属性，所以它才被加入了 ES6 里（ES5 部分浏览器也支持，但还不是标准）。</p>
<h3 id="五-原型链"><a href="#五-原型链" class="headerlink" title="五. 原型链"></a>五. 原型链</h3><p><img src="http://osjvlsq19.bkt.clouddn.com/__proto__.jpg" alt="原型链"></p>
<p>小测试来检验一下你理解的怎么样：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person1.__proto__ 是什么？</span><br><span class="line">Person.__proto__ 是什么？</span><br><span class="line">Person.prototype.__proto__ 是什么？</span><br><span class="line"><span class="built_in">Object</span>.__proto__ 是什么？</span><br><span class="line"><span class="built_in">Object</span>.prototype__proto__ 是什么？</span><br></pre></td></tr></table></figure></p>
<p>答案：<br>第一题：<br>因为 <code>person1.__proto__ === person1</code> 的构造函数.prototype<br>因为 person1的构造函数 === Person<br>所以 <code>person1.__proto__ === Person.prototype</code></p>
<p>第二题：<br>因为 <code>Person.__proto__ === Person</code> 的构造函数.prototype<br>因为 Person的构造函数 === Function<br>所以 <code>Person.__proto__ === Function.prototype</code></p>
<p>第三题：<br>Person.prototype 是一个普通对象，我们无需关注它有哪些属性，只要记住它是一个普通对象。<br>因为一个普通对象的构造函数 === Object<br>所以 <code>Person.prototype.__proto__ === Object.prototype</code></p>
<p>第四题，参照第二题，因为 Person 和 Object 一样都是构造函数</p>
<p>第五题：<br>Object.prototype 对象也有proto属性，但它比较特殊，为 null 。因为 null 处于原型链的顶端，这个只能记住。<br><code>Object.prototype.__proto__ === null</code></p>
<p>普通对象的<code>__proto__</code>指向这个对象（this）的构造函数的prototype;<br>所有函数对象的<code>__proto__</code>都指向Function.prototype，它是一个空函数（Empty function）;</p>
<p>所有的构造器都来自于 Function.prototype，甚至包括根构造器Object及Function自身。所有构造器都继承了 <strong>Function.prototype</strong> 的属性及方法。如length、call、apply、bind.</p>
<p>所有构造器（含内置及自定义）的 <code>__proto__</code> 都是Function.prototype，那Function.prototype的 <code>__proto__</code> 是谁呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>最后Object.prototype的proto是谁？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>  <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p>已经到顶了，为<strong>null</strong>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person1.__proto__ === Person.prototype;</span><br><span class="line">Person.__proto__ === <span class="built_in">Function</span>.prototype;</span><br><span class="line"><span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype;</span><br><span class="line"><span class="built_in">Function</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h3 id="六-设置原型对象"><a href="#六-设置原型对象" class="headerlink" title="六. 设置原型对象"></a>六. 设置原型对象</h3><blockquote>
<p>所有函数对象的 <strong>proto</strong> 都指向 Function.prototype，它是一个空函数（Empty function）</p>
</blockquote>
<blockquote>
<p>所有对象的 <strong>proto</strong> 都指向其构造器的 prototype</p>
</blockquote>
<p>这里定义一个 Person：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === Person.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p>p 是 Person 的实例对象，p 的内部原型总是指向其构造器 Person 的原型对象 prototype。</p>
<p>每个对象都有一个 constructor 属性，可以获取它的构造器，因此以下打印结果也是恒等的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === p.constructor.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面的Person没有给其原型添加属性或方法，这里给其原型添加一个getName方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 修改原型</span></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === Person.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === p.constructor.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到 <code>p.__proto__</code> 与 <code>Person.prototype</code> ，<code>p.constructor.prototype</code> 都是恒等的，即都指向同一个对象。</p>
<p>如果换一种方式设置原型，结果就有些不同了：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 重写原型</span></span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === Person.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(p.__proto__ === p.constructor.prototype) <span class="comment">// false</span></span><br></pre></td></tr></table></figure></p>
<p>这里直接重写了 <code>Person.prototype</code>（注意：上一个示例是修改原型）。输出结果可以看出<code>p.__proto__</code>仍然指向的是<code>Person.prototype</code>，而不是<code>p.constructor.prototype</code>。</p>
<p>这也很好理解，给 <code>Person.prototype</code> 赋值的是一个对象直接量{getName: function(){}}，使用对象直接量方式定义的对象其构造器（constructor）指向的是根构造器Object，Object.prototype是一个空对象{}，{}自然与{getName: function(){}}不等。如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype) <span class="comment">// 为一个空的对象&#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(p.constructor === <span class="built_in">Object</span>) <span class="comment">// 对象直接量方式定义的对象其constructor为Object</span></span><br><span class="line"><span class="built_in">console</span>.log(p.constructor.prototype === <span class="built_in">Object</span>.prototype) <span class="comment">// 为true</span></span><br></pre></td></tr></table></figure>
<h3 id="七-测验与总结"><a href="#七-测验与总结" class="headerlink" title="七. 测验与总结"></a>七. 测验与总结</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">console</span>.log(person1.__proto__ === Person.prototype); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype.__proto__ === <span class="built_in">Object</span>.prototype) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__) <span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">Person.__proto__ == <span class="built_in">Function</span>.prototype; <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Function</span>.prototype)<span class="comment">// function()&#123;&#125; (空函数)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="keyword">new</span> <span class="built_in">Array</span>()</span><br><span class="line"><span class="built_in">console</span>.log(num.__proto__ == <span class="built_in">Array</span>.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="built_in">Array</span>.prototype.__proto__ == <span class="built_in">Object</span>.prototype) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype) <span class="comment">// [] (空数组)</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.__proto__) <span class="comment">//null</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.__proto__ == <span class="built_in">Function</span>.prototype)<span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>疑点解惑：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">`Object.__proto__ === Function.prototype // true`</span><br><span class="line">Object 是函数对象，是通过new Function()创建的，所以 `Object.__proto__` 指向Function.prototype。</span><br><span class="line"></span><br><span class="line">`Function.__proto__ === Function.prototype // true`</span><br><span class="line">Function 也是对象函数，也是通过new Function()创建，所以 `Function.__proto__` 指向Function.prototype。</span><br><span class="line"></span><br><span class="line">`Function.prototype.__proto__ === Object.prototype //true`</span><br><span class="line">其实这一点我也有点困惑，不过也可以试着解释一下。</span><br><span class="line">Function.prototype是个函数对象，理论上他的`__proto__`应该指向 Function.prototype，就是他自己，自己指向自己，没有意义。</span><br><span class="line">JS一直强调万物皆对象，函数对象也是对象，给他认个祖宗，指向Object.prototype。`Object.prototype.__proto__ === null`，保证原型链能够正常结束。</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>原型和原型链是JS实现继承的一种模型。原型链的形成是真正是靠<code>__proto__</code>, 而非prototype</p>
</blockquote>
<p>要深入理解这句话，我们再举个例子，看看前面你真的理解了吗？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> animal = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">animal.price = <span class="number">2000</span>;</span><br><span class="line">dog.prototype = animal;</span><br><span class="line"><span class="keyword">var</span> tidy = <span class="keyword">new</span> dog();</span><br><span class="line"><span class="built_in">console</span>.log(dog.price) <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(tidy.price) <span class="comment">// 2000</span></span><br></pre></td></tr></table></figure>
<p>这里解释一下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line">dog.prototype.price = <span class="number">2000</span>;</span><br><span class="line"><span class="keyword">var</span> tidy = <span class="keyword">new</span> dog();</span><br><span class="line"><span class="built_in">console</span>.log(tidy.price); <span class="comment">// 2000</span></span><br><span class="line"><span class="built_in">console</span>.log(dog.price); <span class="comment">//undefined</span></span><br><span class="line"><span class="keyword">var</span> dog = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> tidy = <span class="keyword">new</span> dog();</span><br><span class="line">tidy.price = <span class="number">2000</span>;</span><br><span class="line"><span class="built_in">console</span>.log(dog.price); <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure></p>
<p>这个明白吧？想一想我们上面说过这句话：</p>
<blockquote>
<p>实例（tidy）和 原型对象（dog.prototype）存在一个连接。不过，要明确的真正重要的一点就是，这个连接存在于实例（tidy）与构造函数的原型对象（dog.prototype）之间，而不是存在于实例（tidy）与构造函数（dog）之间。</p>
</blockquote>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><img src="http://osjvlsq19.bkt.clouddn.com/prototype.png" alt=""></p>
<p>原型对象 <strong>prototype</strong> 是函数创建时自动获得的一个对象，可以理解为是构造函数的一个特殊的实例，主要是要来继承。prototype上面的属性和方法可以共享给其它实例。当其它实例在自身上面找不到所需的属性或方法时，就会沿着原型链 <strong><code>__proto__</code></strong>，向上到 <strong>prototype</strong> 寻找，如果到原型链的末端都没有找到就返回  <strong>undefined</strong>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/05/26/web网络之TCP-IP协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/26/web网络之TCP-IP协议/" itemprop="url">web网络之TCP/IP协议</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-26T19:04:49+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="导语：为什么会有TCP-IP协议"><a href="#导语：为什么会有TCP-IP协议" class="headerlink" title="导语：为什么会有TCP/IP协议"></a>导语：为什么会有TCP/IP协议</h2><p>在世界上各地，各种各样的电脑运行着各自不同的操作系统为大家服务，这些电脑在表达同一种信息的时候所使用的方法是千差万别。就好像圣经中上帝打乱了各地人的口音，让他们无法合作一样。计算机使用者意识到，计算机只是单兵作战并不会发挥太大的作用。只有把它们联合起来，电脑才会发挥出它最大的潜力。于是人们就想方设法的用电线把电脑连接到了一起。</p>
<p>但是简单的连到一起是远远不够的，就好像语言不同的两个人互相见了面，完全不能交流信息。因而他们需要定义一些共通的东西来进行交流，TCP/IP就是为此而生。TCP/IP不是一个协议，而是一个协议族的统称。里面包括了IP协议，IMCP协议，TCP协议，以及我们更加熟悉的http、ftp、pop3协议等等。电脑有了这些，就好像学会了外语一样，就可以和其他的计算机终端做自由的交流了。</p>
<h2 id="TCP-IP协议分层"><a href="#TCP-IP协议分层" class="headerlink" title="TCP/IP协议分层"></a>TCP/IP协议分层</h2><p>OSI七层模型大家应该都烂熟于心了吧：</p>
<p><img src="http://os965hewa.bkt.clouddn.com/osi%E6%A8%A1%E5%9E%8B.jpg" alt="osi模型"></p>
<p>对照OSI七层模型，TCP/IP 可以分层：</p>
<p><img src="http://os965hewa.bkt.clouddn.com/tcp-ip%E6%A8%A1%E5%9E%8B.jpg" alt="tcp/ip模型"></p>
<p>TCP/IP协议族按照层次由上到下，层层包装。</p>
<p><strong>应用层:</strong><br>向用户提供一组常用的应用程序，比如电子邮件、文件传输访问、远程登录等。远程登录TELNET使用TELNET协议提供在网络其它主机上注册的接口。TELNET会话提供了基于字符的虚拟终端。文件传输访问FTP使用FTP协议来提供网络内机器间的文件拷贝功能。</p>
<p><strong>传输层:</strong><br>提供应用程序间的通信。其功能包括：一、格式化信息流；二、提供可靠传输。为实现后者，传输层协议规定接收端必须发回确认，并且假如分组丢失，必须重新发送。</p>
<p><strong>网络层 ：</strong></p>
<p>负责相邻计算机之间的通信。其功能包括三方面。<br>一、处理来自传输层的分组发送请求，收到请求后，将分组装入IP数据报，填充报头，选择去往信宿机的路径，然后将数据报发往适当的网络接口。</p>
<p>二、处理输入数据报：首先检查其合法性，然后进行寻径–假如该数据报已到达信宿机，则去掉报头，将剩下部分交给适当的传输协议；假如该数据报尚未到达信宿，则转发该数据报。</p>
<p>三、处理路径、流控、拥塞等问题。</p>
<p><strong>网络接口层：</strong><br>这是TCP/IP软件的最低层，负责接收IP数据报并通过网络发送之，或者从网络上接收物理帧，抽出IP数据报，交给IP层。</p>
<h3 id="IP是无连接的"><a href="#IP是无连接的" class="headerlink" title="IP是无连接的"></a>IP是无连接的</h3><p>IP 用于计算机之间的通信。</p>
<p>IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。</p>
<p>通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。</p>
<p>IP 负责将每个包路由至它的目的地。</p>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><p>每个计算机必须有一个 IP 地址才能够连入因特网。</p>
<p>每个 IP 包必须有一个地址才能够发送到另一台计算机。</p>
<p>网络上每一个节点都必须有一个独立的Internet地址（也叫做IP地址）。现在，通常使用的IP地址是一个32bit的数字，也就是我们常说的IPv4标准，这32bit的数字分成四组，也就是常见的255.255.255.255的样式。IPv4标准上，地址被分为五类，我们常用的是B类地址。具体的分类请参考其他文档。需要注意的是IP地址是网络号+主机号的组合，这非常重要。</p>
<p>CP/IP 使用 32 个比特来编址。一个计算机字节是 8 比特。所以 TCP/IP 使用了 4 个字节。<br>一个计算机字节可以包含 256 个不同的值：<br>00000000、00000001、00000010、00000011、00000100、00000101、00000110、00000111、00001000 ……. 直到 11111111。<br>现在，你知道了为什么 TCP/IP 地址是介于 0 到 255 之间的 4 个数字。</p>
<h3 id="IP路由器"><a href="#IP路由器" class="headerlink" title="IP路由器"></a>IP路由器</h3><p>当一个 IP 包从一台计算机被发送，它会到达一个 IP 路由器。</p>
<p>IP 路由器负责将这个包路由至它的目的地，直接地或者通过其他的路由器。</p>
<p>在一个相同的通信中，一个包所经由的路径可能会和其他的包不同。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址。</p>
<h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><p>12 个阿拉伯数字很难记忆。使用一个名称更容易。</p>
<p>用于 TCP/IP 地址的名字被称为域名。w3school.com.cn 就是一个域名。</p>
<p>当你键入一个像 <a href="http://www.w3school.com.cn" target="_blank" rel="noopener">http://www.w3school.com.cn</a> 这样的域名，域名会被一种 DNS 程序翻译为数字。</p>
<p>在全世界，数量庞大的 DNS 服务器被连入因特网。DNS 服务器负责将域名翻译为 TCP/IP 地址，同时负责使用新的域名信息更新彼此的系统。</p>
<p>当一个新的域名连同其 TCP/IP 地址一同注册后，全世界的 DNS 服务器都会对此信息进行更新。</p>
<h3 id="TCP使用固定的连接"><a href="#TCP使用固定的连接" class="headerlink" title="TCP使用固定的连接"></a>TCP使用固定的连接</h3><p>TCP 用于应用程序之间的通信。</p>
<p>当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方“握手”之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。</p>
<p>这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。</p>
<p>UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。</p>
<h3 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h3><p>TCP/IP 意味着 TCP 和 IP 在一起协同工作。</p>
<p>TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。</p>
<p>IP 负责计算机之间的通信。</p>
<p>TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。</p>
<p>IP 负责将包发送至接受者。</p>
<h2 id="TCP报文格式"><a href="#TCP报文格式" class="headerlink" title="TCP报文格式"></a>TCP报文格式</h2><p><img src="http://os965hewa.bkt.clouddn.com/tcp%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.jpg" alt="报文格式"></p>
<p><img src="http://os965hewa.bkt.clouddn.com/%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.gif" alt="报文格式"></p>
<font color="#11999E">16位源端口号</font>：16位的源端口中包含初始化通信的端口。源端口和源IP地址的作用是标识报文的返回地址。<br><br><font color="#11999E">16位目的端口号</font>：16位的目的端口域定义传输的目的。这个端口指明报文接收计算机上的应用程序地址接口。<br><br><font color="#11999E">32位序号</font>：32位的序列号由接收端计算机使用，重新分段的报文成最初形式。当SYN出现，序列码实际上是初始序列码（Initial Sequence Number，ISN），而第一个数据字节是ISN+1。这个序列号（序列码）可用来补偿传输中的不一致。<br><br><font color="#11999E">32位确认序号</font>：32位的序列号由接收端计算机使用，重组分段的报文成最初形式。如果设置了ACK控制位，这个值表示一个准备接收的包的序列码。<br><br><font color="#11999E">4位首部长度</font>：4位包括TCP头大小，指示何处数据开始。<br><br><font color="#11999E">保留（6位）</font>：6位值域，这些位必须是0。为了将来定义新的用途而保留。<br><br><font color="#11999E">标志</font>：6位标志域。表示为：紧急标志、有意义的应答标志、推、重置连接标志、同步序列号标志、完成发送数据标志。按照顺序排列是：URG、ACK、PSH、RST、SYN、FIN。<br><br><font color="#11999E">16位窗口大小</font>：用来表示想收到的每个TCP数据段的大小。TCP的流量控制由连接的每一端通过声明的窗口大小来提供。窗口大小为字节数，起始于确认序号字段指明的值，这个值是接收端正期望接收的字节。窗口大小是一个16字节字段，因而窗口大小最大为65535字节。<br><br><font color="#11999E">16位校验和</font>：16位TCP头。源机器基于数据内容计算一个数值，收信息机要与源机器数值 结果完全一样，从而证明数据的有效性。检验和覆盖了整个的TCP报文段：这是一个强制性的字段，一定是由发送端计算和存储，并由接收端进行验证的。<br><br><font color="#11999E">16位紧急指针</font>：指向后面是优先数据的字节，在URG标志设置了时才有效。如果URG标志没有被设置，紧急域作为填充。加快处理标示为紧急的数据段。<br><br><font color="#11999E">选项</font>：长度不定，但长度必须为1个字节。如果没有选项就表示这个1字节的域等于0。<br><br><font color="#11999E">数据</font>：该TCP协议包负载的数据。<br><br>在上述字段中，6位标志域的各个选项功能如下。<br><br><strong>URG</strong>：紧急标志。紧急标志为”1”表明该位有效。<br><br><strong>ACK</strong>：确认标志。表明确认编号栏有效。大多数情况下该标志位是置位的。TCP报头内的确认编号栏内包含的确认编号（w+1）为下一个预期的序列编号，同时提示远端系统已经成功接收所有数据。<br><br><strong>PSH</strong>：推标志。该标志置位时，接收端不将该数据进行队列处理，而是尽可能快地将数据转由应用处理。在处理Telnet或rlogin等交互模式的连接时，该标志总是置位的。<br><br><strong>RST</strong>：复位标志。用于复位相应的TCP连接。<br><br><strong>SYN</strong>：同步标志。表明同步序列编号栏有效。该标志仅在三次握手建立TCP连接时有效。它提示TCP连接的服务端检查序列编号，该序列编号为TCP连接初始端（一般是客户端）的初始序列编号。在这里，可以把TCP序列编号看作是一个范围从0到4，294，967，295的32位计数器。通过TCP连接交换的数据中每一个字节都经过序列编号。在TCP报头中的序列编号栏包括了TCP分段中第一个字节的序列编号。<br><br><strong>FIN</strong>：结束标志。<br><br><br><h2>TCP通信</h2><br><img src="http://os965hewa.bkt.clouddn.com/tcp%E9%80%9A%E4%BF%A1.jpg" alt="TCP通信"><br><br>其实，大家看上面的图，差不多都已经能够摸清楚每次发送请求的内容。其实，TCP3次握手是为了建立 稳定可靠的连接。所以也就不存在神马 2次连接等的怪癖。<br>(图中flag说明:<strong>SYN</strong>包表示标志位<strong>SYN=1</strong>，<strong>ACK</strong>包表示标志位<strong>ACK=1</strong>，<strong>SYN+ACK</strong>包表示标志位<strong>SYN=1，ACK=1</strong>)<br><br><h3>TCP三次握手</h3><br>现在，我们来正式进入3次握手环节。<br><br><strong>第一次握手</strong>: 客户端向服务器发送一个SYN包，并且添加上seqNumber(假设为x)，然后进入SYN_SEND状态，并且等待服务器的确认。<br><strong>第二次握手</strong>: 服务器接受SYN包，并且进行确认，如果该请求有效，则将<code>TCP flags</code>中的ACK 标志位置1， 然后将AckNumber置为(seqNumber+1)，并且再添加上自己的seqNumber(y)， 完成后，返回给客户端.服务器进入SYN_RECV状态.(这里服务端是发送SYN+ACK包)<br><strong>第三次握手</strong>: 客户端接受ACK+SYN报文后，获取到服务器发送seqNumber(y)， 并且将新头部的AckNumber变为(y+1).然后发送给服务器，完成TCP3次连接。此时服务器和客户端都进入ESTABLISHED状态.<br><br>回答一下这个比较尴尬的问题，为什么只有3次握手，而不是4次，或者2次？<br>很简单呀，因为3次就够了，干嘛用4次。23333. 举个例子吧，假如是2次的话， 可能会出现这样一个情况。<br><br>当客户端发送一次请求A后，但是A在网络延迟了很久， 接着客户端又发送了一次B，但是此时A已经无效了。 接着服务器相应了B，并返回TCP连接头，建立连接(这里就2次哈)。 然后，A 历经千山万水终于到服务器了， 服务器一看有请求来了，则接受，由于一开始A带着的TCP格式都是正确的，那么服务器，理所应当的也返回成功连接的flag，但是，此时客户端已经判断该次请求无效，废弃了。 然后服务器，就这么一直挂着(浪费资源)，造成的一个问题是，md， 这个锅是谁的？ 所以，为了保险起见，再补充一次连接就可以了。所以3次是最合适的。如果你用4，5，6，7，8…次的话，这不更浪费吗？<br><br>对于建链接的3次握手，主要是要初始化Sequence Number 的初始值。通信的双方要互相通知对方自己的初始化的Sequence Number（缩写为ISN：Inital Sequence Number）——所以叫SYN，全称Synchronize Sequence Numbers。也就上图中的 x 和 y。这个号要作为以后的数据通信的序号，以保证应用层接收到的数据不会因为网络上的传输的问题而乱序（TCP会用这个序号来拼接数据）。<br><br><h3>TCP四次挥手</h3><br><strong>第一次挥手</strong>: 客户端感觉此时如果<code>keep-alive</code>比较浪费资源，则他提出了分手的请求。设置<code>SeqNumber</code>和<code>AckNumber</code>之后，向服务端发送FIN包， 表示我这已经没有数据给你了。然后客户端进入<code>FIN_WAIT_1</code>状态<br><strong>第二次挥手</strong>:服务端收到了客户端机的FIN包，已经知道了客户端没有数据再发送了。此时服务端会给客户端发送一个ACK包，并且将AckNumber 变为客户端传输来的SeqNumber+1. 当客户端接受到之后，则变为<code>FIN_WAIT_2</code>状态。表示已经得到服务端的许可，可以进行关闭操作。不过此时，服务端还是可以向客户端发送请求的。<br><strong>第三次挥手</strong>: 服务端向客户端发送FIN包，请求关闭，相当于告诉客户端，我这里也没有你要的数据了。然后服务端进入<code>CLOSE_WAIT</code>状态.（这里还需要带上SeqNumber，大家看图说话就可以了）<br><strong>第四次挥手</strong>: 客户端接收到服务端的FIN包之后，然后同样，发送一个ACK包给服务端。 服务端接受到之后，就断开了。 而客户端会等待<strong>2MSL</strong>之后，如果没有回复，确保服务器端确实是关闭了。然后A机也可以关闭连接。客户端，服务端都进入了CLOSE状态.<br>明白了吗？<br>大哥~ 等等，什么是2MSL呀~<br>哦，对哦。 这个还么说…<br>2MSL=2*MSL. 而MSL其实就是Maximum Segment Lifetime，中文意思就是报文最大生存时间。RFC 793中规定MSL为2分钟，实际应用中常用的是30秒，1分钟和2分钟等。 同样上面的TIME_WAT状态其实也就是2MSL状态。 如果超过改时间，则会将该报文废弃，然后直接进入CLOSED状态.<br><br><h4>为什么建立连接是三次握手，而关闭连接却是四次挥手呢？</h4><br>这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。<br><br>对于4次挥手，其实你仔细看是2次，因为TCP是全双工的，所以，发送方和接收方都需要Fin和Ack。只不过，有一方是被动的，所以看上去就成了所谓的4次挥手。如果两边同时断连接，那就会就进入到CLOSING状态，然后到达TIME_WAIT状态。<br><br>之所以绝大数时候我们看到的都是四次挥手，是因为收到fin后，知道对方要关闭了，然后OS通知应用层要关闭啥的，这里应用层可能需要做些准备工作，有一些延时，所以先回ack，准备好了再发fin 。 握手过程没有这个准备过程所以可以立即发送syn+ack。<br><br><h4>为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？</h4><br>原因有二：<br>- <font color="#11999E">保证TCP协议的全双工连接能够可靠关闭</font><br>- <font color="#11999E">保证这次连接的重复数据段从网络中消失</font>

<p>先说第一点，如果Client直接CLOSED了，那么由于IP协议的不可靠性或者是其它网络原因，导致Server没有收到Client最后回复的ACK。那么Server就会在超时之后继续发送FIN，此时由于Client已经CLOSED了，就找不到与重发的FIN对应的连接，最后Server就会收到RST而不是ACK，Server就会以为是连接错误把问题报告给高层。这样的情况虽然不会造成数据丢失，但是却导致TCP协议不符合可靠连接的要求。所以，Client不是直接进入CLOSED，而是要保持TIME_WAIT，当再次收到FIN的时候，能够保证对方收到ACK，最后正确的关闭连接。</p>
<p>再说第二点，如果Client直接CLOSED，然后又再向Server发起一个新连接，我们不能保证这个新连接与刚关闭的连接的端口号是不同的。也就是说有可能新连接和老连接的端口号是相同的。一般来说不会发生什么问题，但是还是有特殊情况出现：假设新连接和已经关闭的老连接端口号是一样的，如果前一次连接的某些数据仍然滞留在网络中，这些延迟数据在建立新连接之后才到达Server，由于新连接和老连接的端口号是一样的，又因为TCP协议判断不同连接的依据是socket pair，于是，TCP协议就认为那个延迟的数据是属于新连接的，这样就和真正的新连接的数据包发生混淆了。所以TCP连接还要在TIME_WAIT状态等待2倍MSL，这样可以保证本次连接的所有数据都从网络中消失。</p>
<h3 id="TCP链接中的其它信息"><a href="#TCP链接中的其它信息" class="headerlink" title="TCP链接中的其它信息"></a>TCP链接中的其它信息</h3><h4 id="ack-seq-len"><a href="#ack-seq-len" class="headerlink" title="ack=seq+len"></a>ack=seq+len</h4><p>ack总是seq+len（包的大小），这样发送方明确知道server收到那些东西了。</p>
<p>但是特例是三次握手和四次挥手，虽然len都是0，但是syn和fin都要占用一个seq号，所以这里的ack都是seq+1。</p>
<p><img src="http://os965hewa.bkt.clouddn.com/ack=sep+len.png" alt="ack=sep+len"></p>
<p>看图中左边红框里的len+seq就是接收方回复的ack的数字，表示这个包接收方收到了。然后下一个包的seq就是前一个包的len+seq，依次增加，一旦中间发出去的东西没有收到ack就是丢包了，过一段时间（或者其他方式）触发重传，保障了tcp传输的可靠性。</p>
<h4 id="三次握手中的其它信息"><a href="#三次握手中的其它信息" class="headerlink" title="三次握手中的其它信息"></a>三次握手中的其它信息</h4><p><font color="#11999E">MSS </font>最大一个包中能传输的信息（不含tcp、ip包头），MSS+包头就是MTU（最大传输单元），如果MTU过大可能在传输的过程中被卡住过不去造成卡死（这个大小的包一直传输不过去），跟丢包还不一样。</p>
<p><font color="#11999E">SACK_PERM </font>用于丢包的话提升重传效率，比如client一次发了1、2、3、4、5 这5个包给server，实际server收到了 1、3、4、5这四个包，中间2丢掉了。这个时候server回复ack的时候，都只能回复2，表示2前面所有的包都收到了，给我发第二个包吧，如果server 收到3、4、5还是没有收到2的话，也是回复ack 2而不是回复ack 3、4、5、6的，表示快点发2过来。</p>
<p>但是这个时候client虽然知道2丢了，然后会重发2，但是不知道3、4、5有没有丢啊，实际3、4、5 server都收到了，如果支持sack，那么可以ack 2的时候同时告诉client 3、4、5都收到了，这样client重传的时候只重传2就可以，如果没有sack的话那么可能会重传2、3、4、5，这样效率就低了。</p>
<p>来看一个例子：</p>
<p><img src="http://os965hewa.bkt.clouddn.com/sack.png" alt="sack"></p>
<p>图中的红框就是SACK。</p>
<p>知识点：ack数字表示这个数字前面的数据都收到了。</p>
<h4 id="TCP链接中其它问题"><a href="#TCP链接中其它问题" class="headerlink" title="TCP链接中其它问题"></a>TCP链接中其它问题</h4><p><strong><font color="#11999E">关于建连接时SYN超时</font></strong><br>试想一下，如果server端接到了clien发的SYN后回了SYN-ACK后client掉线了，server端没有收到client回来的ACK，那么，这个连接处于一个中间状态，即没成功，也没失败。于是，server端如果在一定时间内没有收到的TCP会重发SYN-ACK。在Linux下，默认重试次数为5次，重试的间隔时间从1s开始每次都翻售，5次的重试时间间隔为1s， 2s， 4s， 8s， 16s，总共31s，第5次发出后还要等32s都知道第5次也超时了，所以，总共需要 1s + 2s + 4s+ 8s+ 16s + 32s = 2^6 -1 = 63s，TCP才会把断开这个连接。</p>
<p><strong><font color="#11999E">关于SYN Flood攻击</font></strong><br>一些恶意的人就为此制造了SYN Flood攻击——给服务器发了一个SYN后，就下线了，于是服务器需要默认等63s才会断开连接，这样，攻击者就可以把服务器的syn连接的队列耗尽，让正常的连接请求不能处理。于是，Linux下给了一个叫<code>tcp_syncookies</code>的参数来应对这个事——当SYN队列满了后，TCP会通过源地址端口、目标地址端口和时间戳打造出一个特别的Sequence Number发回去（又叫cookie），如果是攻击者则不会有响应，如果是正常连接，则会把这个 SYN Cookie发回来，然后服务端可以通过cookie建连接（即使你不在SYN队列中）。请注意，请先千万别用<code>tcp_syncookies</code>来处理正常的大负载的连接的情况。因为，synccookies是妥协版的TCP协议，并不严谨。对于正常的请求，你应该调整三个TCP参数可供你选择，第一个是：<code>tcp_synack_retries</code>可以用他来减少重试次数；第二个是：<code>tcp_max_syn_backlog</code>，可以增大SYN连接数；第三个是：<code>tcp_abort_on_overflow</code>处理不过来干脆就直接拒绝连接了。</p>
<p><strong><font color="#11999E">关于ISN的初始化</font></strong><br>ISN（Inital Sequence Number）是不能hard code的，不然会出问题的——比如：如果连接建好后始终用1来做ISN，如果client发了30个segment过去，但是网络断了，于是 client重连，又用了1做ISN，但是之前连接的那些包到了，于是就被当成了新连接的包，此时，client的Sequence Number 可能是3，而Server端认为client端的这个号是30了。全乱了。RFC793中说，ISN会和一个假的时钟绑在一起，这个时钟会在每4微秒对ISN做加一操作，直到超过2^32，又从0开始。这样，一个ISN的周期大约是4.55个小时。因为，我们假设我们的TCP Segment在网络上的存活时间不会超过Maximum Segment Lifetime（缩写为MSL – Wikipedia语条），所以，只要MSL的值小于4.55小时，那么，我们就不会重用到ISN。</p>
<p><strong><font color="#11999E">关于 MSL 和 TIME_WAIT</font></strong><br>通过上面的ISN的描述，相信你也知道MSL是怎么来的了。我们注意到，在TCP的状态图中，从<code>TIME_WAIT</code>状态到<code>CLOSED</code>状态，有一个超时设置，这个超时设置是 2*MSL（RFC793定义了MSL为2分钟，Linux设置成了30s）为什么要这有<code>TIME_WAIT</code>？为什么不直接给转成CLOSED状态呢？主要有两个原因：1）TIME_WAIT确保有足够的时间让对端收到了ACK，如果被动关闭的那方没有收到Ack，就会触发被动端重发Fin，一来一去正好2个MSL，2）有足够的时间让这个连接不会跟后面的连接混在一起（你要知道，有些自做主张的路由器会缓存IP数据包，如果连接被重用了，那么这些延迟收到的包就有可能会跟新连接混在一起）。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>TCP所有特性基本上都是为<strong>可靠传输</strong>这个目标服务的，然后有一些是出于优化性能的目的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/05/21/web网络之XMLHttpRequest/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/21/web网络之XMLHttpRequest/" itemprop="url">web网络之XMLHttpRequest</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-21T21:09:24+08:00">
                2017-05-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="导语"><a href="#导语" class="headerlink" title="导语"></a>导语</h3><p>继<strong>HTTP</strong>之后，来梳理一下<strong><font color="#F57170"><code>XMLHttpRequest</code></font></strong>。如果用过jQuery，那几乎也用过$.ajax吧，估计也是成功地发过很多个Ajax请求了。本文主要从的标准和API回顾<font color="#F57170">XMLHttpRequest</font>。</p>
<h3 id="Ajax和XMLHttpRequest"><a href="#Ajax和XMLHttpRequest" class="headerlink" title="Ajax和XMLHttpRequest"></a>Ajax和<font color="#F57170">XMLHttpRequest</font></h3><p>日常开发中，好像很少将<code>Ajax</code>和<font color="#F57170">XMLHttpRequest</font>区分开来，但其实这是两个不同维度的概念。</p>
<p>ajax依赖现有的CSS/HTML/Javascript，而其中最核心的依赖是浏览器提供的<font color="#F57170">XMLHttpRequest</font>对象，是这个对象使得浏览器可以发出HTTP请求与接收HTTP响应。</p>
<p>所以两者的关系：我们使用<font color="#F57170">XMLHttpRequest</font>对象来发送一个Ajax请求。</p>
<h3 id="XMLHttpRequest的发展历程"><a href="#XMLHttpRequest的发展历程" class="headerlink" title="XMLHttpRequest的发展历程"></a><font color="#F57170">XMLHttpRequest</font>的发展历程</h3><p><font color="#F57170">XMLHttpRequest</font>一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了<font color="#F57170">XMLHttpRequest</font>标准。<font color="#F57170">XMLHttpRequest</font>标准又分为Level 1和Level 2。</p>
<p><font color="#F57170">XMLHttpRequest</font> Level 1主要存在以下缺点：</p>
<ul>
<li>受同源策略的限制，不能发送跨域请求；</li>
<li>不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；</li>
<li>在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；</li>
</ul>
<p>那么Level 2对Level 1 进行了改进，<font color="#F57170">XMLHttpRequest</font> Level 2中新增了以下功能：</p>
<ul>
<li>可以发送跨域请求，在服务端允许的情况下；</li>
<li>支持发送和接收二进制数据；</li>
<li>新增formData对象，支持发送表单数据；</li>
<li>发送和获取数据时，可以获取进度信息；</li>
<li>可以设置请求的超时时间；</li>
</ul>
<p>更多详细可以访问 <a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html</a></p>
<h3 id="XMLHttpRequest兼容性"><a href="#XMLHttpRequest兼容性" class="headerlink" title="XMLHttpRequest兼容性"></a><font color="#F57170">XMLHttpRequest</font>兼容性</h3><p>关于xhr的浏览器兼容性，大家可以直接查看“Can I use”这个网站提供的结果<font color="#F57170">XMLHttpRequest</font>兼容性，下面提供一个截图。</p>
<p><img src="http://os965hewa.bkt.clouddn.com/XMLHttpRequest%E5%85%BC%E5%AE%B9%E6%80%A7.png" alt="兼容性"></p>
<p>从图中可以看到：</p>
<ul>
<li>IE8/IE9、Opera Mini 完全不支持xhr对象</li>
<li>IE10/IE11部分支持，不支持 xhr.responseType为json</li>
<li>部分浏览器不支持设置请求超时，即无法使用xhr.timeout</li>
<li>部分浏览器不支持xhr.responseType为blob</li>
</ul>
<h3 id="细说XMLHttpRequest如何使用"><a href="#细说XMLHttpRequest如何使用" class="headerlink" title="细说XMLHttpRequest如何使用"></a>细说<font color="#F57170">XMLHttpRequest</font>如何使用</h3><p>先来看一段使用<font color="#F57170">XMLHttpRequest</font>发送Ajax请求的简单示例代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendAjax</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//构造表单数据</span></span><br><span class="line">  <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  formData.append(<span class="string">'username'</span>, <span class="string">'johndoe'</span>);</span><br><span class="line">  formData.append(<span class="string">'id'</span>, <span class="number">123456</span>);</span><br><span class="line">  <span class="comment">//创建xhr对象 </span></span><br><span class="line">  <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  <span class="comment">//设置xhr请求的超时时间</span></span><br><span class="line">  xhr.timeout = <span class="number">3000</span>;</span><br><span class="line">  <span class="comment">//设置响应返回的数据格式</span></span><br><span class="line">  xhr.responseType = <span class="string">"text"</span>;</span><br><span class="line">  <span class="comment">//创建一个 post 请求，采用异步</span></span><br><span class="line">  xhr.open(<span class="string">'POST'</span>, <span class="string">'/server'</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">//注册相关事件回调处理函数</span></span><br><span class="line">  xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.status == <span class="number">200</span>||<span class="keyword">this</span>.status == <span class="number">304</span>)&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; ... &#125;;</span><br><span class="line">  xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; ... &#125;;</span><br><span class="line">  xhr.upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123; ... &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//发送数据</span></span><br><span class="line">  xhr.send(formData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是一个使用xhr发送表单数据的示例，整个流程可以参考注释。</p>
<h4 id="如何设置request-header"><a href="#如何设置request-header" class="headerlink" title="如何设置request header"></a>如何设置request header</h4><p>在发送Ajax请求（实质是一个HTTP请求）时，我们可能需要设置一些请求头部信息，比如content-type、connection、cookie、accept-xxx等。xhr提供了setRequestHeader来允许我们修改请求 header。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> setRequestHeader(DOMString header, DOMString value);</span><br></pre></td></tr></table></figure>
<p>注意点：</p>
<ul>
<li>方法的第一个参数 header 大小写不敏感，即可以写成content-type，也可以写成Content-Type，甚至写成content-Type;</li>
<li>Content-Type的默认值与具体发送的数据类型有关，请参考本文【可以发送什么类型的数据】一节；</li>
<li>setRequestHeader必须在open()方法之后，send()方法之前调用，否则会抛错；</li>
<li>setRequestHeader可以调用多次，最终的值不会采用覆盖override的方式，而是采用追加append的方式。</li>
</ul>
<p>下面是一个示例代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">client.open(<span class="string">'GET'</span>, <span class="string">'demo.cgi'</span>);</span><br><span class="line">client.setRequestHeader(<span class="string">'X-Test'</span>, <span class="string">'one'</span>);</span><br><span class="line">client.setRequestHeader(<span class="string">'X-Test'</span>, <span class="string">'two'</span>);</span><br><span class="line"><span class="comment">// 最终request header中"X-Test"为: one, two</span></span><br><span class="line">client.send();</span><br></pre></td></tr></table></figure></p>
<h4 id="如何获取response-header"><a href="#如何获取response-header" class="headerlink" title="如何获取response header"></a>如何获取response header</h4><p>xhr提供了2个用来获取响应头部的方法：<em>getAllResponseHeaders</em>和<em>getResponseHeader</em>。前者是获取 response 中的所有header 字段，后者只是获取某个指定 header 字段的值。另外，getResponseHeader(header)的header参数不区分大小写。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DOMString getAllResponseHeaders();</span><br><span class="line">DOMString getResponseHeader(DOMString header);</span><br></pre></td></tr></table></figure>
<p>这2个方法看起来简单，但却处处是坑儿。</p>
<p>-使用<code>getAllResponseHeaders()</code>看到的所有response header与实际在控制台 Network 中看到的 response header 不一样</p>
<ul>
<li>使用<code>getResponseHeader()</code>获取某个 header 的值时，浏览器抛错Refused to get unsafe header “XXX”</li>
</ul>
<ul>
<li>原因1：W3C的 xhr 标准中做了限制，规定客户端无法获取 response 中的 Set-Cookie、Set-Cookie2这2个字段，无论是同域还是跨域请求；</li>
<li>原因2：W3C 的 cors 标准对于跨域请求也做了限制，规定对于跨域请求，客户端允许获取的response header字段只限于“simple response header”和“Access-Control-Expose-Headers” （两个名词的解释见下方）。</li>
</ul>
<blockquote>
<p>“simple response header”包括的 header 字段有：Cache-Control,Content-Language,Content-Type,Expires,Last-Modified,Pragma;<br>“Access-Control-Expose-Headers”：首先得注意是”Access-Control-Expose-Headers”进行跨域请求时响应头部中的一个字段，对于同域请求，响应头部是没有这个字段的。这个字段中列举的 header 字段就是服务器允许暴露给客户端访问的字段。</p>
</blockquote>
<p>所以getAllResponseHeaders()只能拿到限制以外（即被视为safe）的header字段，而不是全部字段；而调用getResponseHeader(header)方法时，header参数必须是限制以外的header字段，否则调用就会报<em>Refused to get unsafe header</em>的错误。</p>
<h4 id="如何指定xhr-response的数据类型"><a href="#如何指定xhr-response的数据类型" class="headerlink" title="如何指定xhr.response的数据类型"></a>如何指定xhr.response的数据类型</h4><p>有些时候我们希望xhr.response返回的就是我们想要的数据类型。比如：响应返回的数据是纯JSON字符串，但我们期望最终通过xhr.response拿到的直接就是一个 js 对象，我们该怎么实现呢？<br>有2种方法可以实现，一个是level 1就提供的overrideMimeType()方法，另一个是level 2才提供的xhr.responseType属性。</p>
<h5 id="xhr-overrideMimeType"><a href="#xhr-overrideMimeType" class="headerlink" title="xhr.overrideMimeType()"></a>xhr.overrideMimeType()</h5><p>overrideMimeType是xhr level 1就有的方法，所以浏览器兼容性良好。这个方法的作用就是用来重写response的content-type，这样做有什么意义呢？比如：server 端给客户端返回了一份document或者是 xml文档，我们希望最终通过xhr.response拿到的就是一个DOM对象，那么就可以用xhr.overrideMimeType(‘text/xml; charset = utf-8’)来实现。</p>
<p>再举一个使用场景，我们都知道xhr level 1不支持直接传输blob二进制数据，那如果真要传输 blob 该怎么办呢？当时就是利用overrideMimeType方法来解决这个问题的。</p>
<p>下面是一个获取图片文件的代码示例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">//向 server 端获取一张图片</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/path/to/image.png'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这行是关键！</span></span><br><span class="line"><span class="comment">//将响应数据按照纯文本格式来解析，字符集替换为用户自己定义的字符集</span></span><br><span class="line">xhr.overrideMimeType(<span class="string">'text/plain; charset=x-user-defined'</span>);</span><br><span class="line"></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.readyState == <span class="number">4</span> &amp;&amp; <span class="keyword">this</span>.status == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">//通过 responseText 来获取图片文件对应的二进制字符串</span></span><br><span class="line">    <span class="keyword">var</span> binStr = <span class="keyword">this</span>.responseText;</span><br><span class="line">    <span class="comment">//然后自己再想方法将逐个字节还原为二进制数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = binStr.length; i &lt; len; ++i) &#123;</span><br><span class="line">      <span class="keyword">var</span> c = binStr.charCodeAt(i);</span><br><span class="line">      <span class="comment">//String.fromCharCode(c &amp; 0xff);</span></span><br><span class="line">      <span class="keyword">var</span> byte = c &amp; <span class="number">0xff</span>; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure></p>
<p>代码示例中xhr请求的是一张图片，通过将 response 的 content-type 改为’text/plain; charset=x-user-defined’，使得 xhr 以纯文本格式来解析接收到的blob 数据，最终用户通过this.responseText拿到的就是图片文件对应的二进制字符串，最后再将其转换为 blob 数据。</p>
<h5 id="xhr-responseType"><a href="#xhr-responseType" class="headerlink" title="xhr.responseType"></a>xhr.responseType</h5><p>responseType是xhr level 2新增的属性，用来指定xhr.response的数据类型，目前还存在些兼容性问题，可以参考本文的【XMLHttpRequest的兼容性】这一小节。那么responseType可以设置为哪些格式呢，我简单做了一个表，如下<br><img src="http://os965hewa.bkt.clouddn.com/responseType.png" alt="responseType"></p>
<p>下面是同样是获取一张图片的代码示例，相比xhr.overrideMimeType,用xhr.response来实现简单得多。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/path/to/image.png'</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//可以将`xhr.responseType`设置为`"blob"`也可以设置为`" arrayBuffer"`</span></span><br><span class="line"><span class="comment">//xhr.responseType = 'arrayBuffer';</span></span><br><span class="line">xhr.responseType = <span class="string">'blob'</span>;</span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.status == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> blob = <span class="keyword">this</span>.response;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<h5 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h5><p>虽然在xhr level 2中，2者是共同存在的。但其实不难发现，xhr.responseType就是用来取代xhr.overrideMimeType()的，xhr.responseType功能强大的多，xhr.overrideMimeType()能做到的xhr.responseType都能做到。所以我们现在完全可以摒弃使用xhr.overrideMimeType()了。</p>
<h4 id="如何获取response数据"><a href="#如何获取response数据" class="headerlink" title="如何获取response数据"></a>如何获取response数据</h4><p>xhr提供了3个属性来获取请求返回的数据，分别是：xhr.response、xhr.responseText、xhr.responseXML</p>
<ul>
<li>xhr.response<ul>
<li>默认值：空字符串””</li>
<li>当请求完成时，此属性才有正确的值</li>
<li>请求未完成时，此属性的值可能是””或者null，具体与xhr.responseType有关：当responseType为””或”text”时，值为””,responseType为其他值时,值为 null</li>
</ul>
</li>
<li>xhr.responseText<ul>
<li>默认值为空字符串””</li>
<li>只有当 responseType 为”text”、””时，xhr对象上才有此属性，此时才能调用xhr.responseText，否则抛错</li>
<li>只有当请求成功时，才能拿到正确值。以下2种情况下值都为空字符串””：请求未完成、请求失败</li>
</ul>
</li>
<li>xhr.responseXML<ul>
<li>默认值为 null</li>
<li>只有当 responseType 为”text”、””、”document”时，xhr对象上才有此属性，此时才能调用xhr.responseXML，否则抛错</li>
<li>只有当请求成功且返回数据被正确解析时，才能拿到正确值。以下3种情况下值都为null：请求未完成、请求失败、请求成功但返回数据无法被正确解析时</li>
</ul>
</li>
</ul>
<h4 id="如何追踪ajax请求的当前状态"><a href="#如何追踪ajax请求的当前状态" class="headerlink" title="如何追踪ajax请求的当前状态"></a>如何追踪ajax请求的当前状态</h4><p>在发一个ajax请求后，如果想追踪请求当前处于哪种状态，该怎么做呢？</p>
<p>用xhr.readyState这个属性即可追踪到。这个属性是只读属性，总共有5种可能值，分别对应xhr不同的不同阶段。每次xhr.readyState的值发生变化时，都会触发xhr.onreadystatechange事件，我们可以在这个事件中进行相关状态判断。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">switch</span>(xhr.readyState)&#123;</span><br><span class="line">     <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//OPENED</span></span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">     <span class="keyword">case</span> <span class="number">2</span>:<span class="comment">//HEADERS_RECEIVED</span></span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">     <span class="keyword">case</span> <span class="number">3</span>:<span class="comment">//LOADING</span></span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">     <span class="keyword">case</span> <span class="number">4</span>:<span class="comment">//DONE</span></span><br><span class="line">       <span class="comment">//do something</span></span><br><span class="line">       <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://os965hewa.bkt.clouddn.com/status.png" alt="status"></p>
<h4 id="如何设置请求的超时时间"><a href="#如何设置请求的超时时间" class="headerlink" title="如何设置请求的超时时间"></a>如何设置请求的超时时间</h4><p>如果请求过了很久还没有成功，为了不会白白占用的网络资源，我们一般会主动终止请求。<font color="#F57170">XMLHttpRequest</font>提供了timeout属性来允许设置请求的超时时间。</p>
<blockquote>
<p>xhr.timeout</p>
</blockquote>
<p>单位：milliseconds 毫秒<br>默认值：0，即不设置超时</p>
<p>很多同学都知道：从请求开始 算起，若超过 timeout 时间请求还没有结束（包括成功/失败），则会触发ontimeout事件，主动结束该请求。</p>
<p>-【那么到底什么时候才算是请求开始 ？】<br>——xhr.onloadstart事件触发的时候，也就是你调用xhr.send()方法的时候。<br>因为xhr.open()只是创建了一个连接，但并没有真正开始数据的传输，而xhr.send()才是真正开始了数据的传输过程。只有调用了xhr.send()，才会触发xhr.onloadstart 。</p>
<p>-【那么什么时候才算是请求结束 ？】<br>—— xhr.loadend事件触发的时候。</p>
<p>另外，还有2个需要注意的坑儿：</p>
<pre><code>- 可以在 send()之后再设置此xhr.timeout，但计时起始点仍为调用xhr.send()方法的时刻。
- 当xhr为一个sync同步请求时，xhr.timeout必须置为0，否则会抛错。原因可以参考本文的【如何发一个同步请求】一节。
</code></pre><h4 id="如何发一个同步请求"><a href="#如何发一个同步请求" class="headerlink" title="如何发一个同步请求"></a>如何发一个同步请求</h4><p>xhr默认发的是异步请求，但也支持发同步请求（当然实际开发中应该尽量避免使用）。到底是异步还是同步请求，由xhr.open（）传入的async参数决定。</p>
<blockquote>
<p>open(method, url [, async = true [, username = null [, password = null]]])</p>
</blockquote>
<ul>
<li>method: 请求的方式，如GET/POST/HEADER等，这个参数不区分大小写</li>
<li>url: 请求的地址，可以是相对地址如example.php，这个相对是相对于当前网页的url路径；也可以是绝对地址如<a href="http://www.example.com/example.php" target="_blank" rel="noopener">http://www.example.com/example.php</a></li>
<li>async: 默认值为true，即为异步请求，若async=false，则为同步请求<br>在我认真研读W3C 的 xhr 标准前，我总以为同步请求和异步请求只是阻塞和非阻塞的区别，其他什么事件触发、参数设置应该是一样的，事实证明我错了。</li>
</ul>
<p>W3C 的 xhr标准中关于open()方法有这样一段说明：</p>
<blockquote>
<p>Throws an “InvalidAccessError” exception if async is false, the JavaScript global environment is a document environment, and either the timeout attribute is not zero, the withCredentials attribute is true, or the responseType attribute is not the empty string.<br>从上面一段说明可以知道，当xhr为同步请求时，有如下限制：</p>
</blockquote>
<pre><code>- xhr.timeout必须为0
- xhr.withCredentials必须为 false
- xhr.responseType必须为&quot;&quot;（注意置为&quot;text&quot;也不允许）
</code></pre><p>若上面任何一个限制不满足，都会抛错，而对于异步请求，则没有这些参数设置上的限制。</p>
<p>之前说过页面中应该尽量避免使用sync同步请求，为什么呢？<br>因为我们无法设置请求超时时间（xhr.timeout为0，即不限时）。在不限制超时的情况下，有可能同步请求一直处于pending状态，服务端迟迟不返回响应，这样整个页面就会一直阻塞，无法响应用户的其他交互。</p>
<p>另外，标准中并没有提及同步请求时事件触发的限制，但实际开发中我确实遇到过部分应该触发的事件并没有触发的现象。如在 chrome中，当xhr为同步请求时，在xhr.readyState由2变成3时，并不会触发 onreadystatechange事件，xhr.upload.onprogress和 xhr.onprogress事件也不会触发。</p>
<h4 id="如何获取上传、下载的进度"><a href="#如何获取上传、下载的进度" class="headerlink" title="如何获取上传、下载的进度"></a>如何获取上传、下载的进度</h4><p>在上传或者下载比较大的文件时，实时显示当前的上传、下载进度是很普遍的产品需求。<br>我们可以通过onprogress事件来实时显示进度，默认情况下这个事件每50ms触发一次。需要注意的是，上传过程和下载过程触发的是不同对象的onprogress事件：</p>
<p>上传触发的是xhr.upload对象的 onprogress事件<br>下载触发的是xhr对象的onprogress事件<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xhr.onprogress = updateProgress;</span><br><span class="line">xhr.upload.onprogress = updateProgress;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateProgress</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.lengthComputable) &#123;</span><br><span class="line">      <span class="keyword">var</span> completedPercent = event.loaded / event.total;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="可以发送什么类型的数据"><a href="#可以发送什么类型的数据" class="headerlink" title="可以发送什么类型的数据"></a>可以发送什么类型的数据</h4><blockquote>
<p>void send(data);</p>
</blockquote>
<p>xhr.send(data)的参数data可以是以下几种类型：</p>
<pre><code>- ArrayBuffer
- Blob
- Document
- DOMString
- FormData
- null
</code></pre><p>如果是 GET/HEAD请求，send()方法一般不传参或传 null。不过即使你真传入了参数，参数也最终被忽略，xhr.send(data)中的data会被置为 null.</p>
<p>xhr.send(data)中data参数的数据类型会影响请求头部content-type的默认值：</p>
<pre><code>如果data是 Document 类型，同时也是HTML Document类型，则content-type默认值为text/html;charset=UTF-8;否则为application/xml;charset=UTF-8；
如果data是 DOMString 类型，content-type默认值为text/plain;charset=UTF-8；
如果data是 FormData 类型，content-type默认值为multipart/form-data; boundary=[xxx]
如果data是其他类型，则不会设置content-type的默认值
当然这些只是content-type的默认值，但如果用xhr.setRequestHeader()手动设置了中content-type的值，以上默认值就会被覆盖。
</code></pre><p>另外需要注意的是，若在断网状态下调用xhr.send(data)方法，则会抛错：Uncaught NetworkError: Failed to execute ‘send’ on ‘XMLHttpRequest’。一旦程序抛出错误，如果不 catch 就无法继续执行后面的代码，所以调用 xhr.send(data)方法时，应该用 try-catch捕捉错误。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    xhr.send(data)</span><br><span class="line">  &#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="comment">//doSomething...</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></p>
<h4 id="xhr-withCredentials与-CORS-什么关系"><a href="#xhr-withCredentials与-CORS-什么关系" class="headerlink" title="xhr.withCredentials与 CORS 什么关系"></a>xhr.withCredentials与 CORS 什么关系</h4><p>我们都知道，在发同域请求时，浏览器会将cookie自动加在request header中。但大家是否遇到过这样的场景：在发送跨域请求时，cookie并没有自动加在request header中。<br>造成这个问题的原因是：在CORS标准中做了规定，默认情况下，浏览器在发送跨域请求时，不能发送任何认证信息（credentials）如”cookies”和”HTTP authentication schemes”。除非xhr.withCredentials为true（xhr对象有一个属性叫withCredentials，默认值为false）。</p>
<p>所以根本原因是cookies也是一种认证信息，在跨域请求中，client端必须手动设置xhr.withCredentials=true，且server端也必须允许request能携带认证信息（即response header中包含Access-Control-Allow-Credentials:true），这样浏览器才会自动将cookie加在request header中。</p>
<p>另外，要特别注意一点，一旦跨域request能够携带认证信息，server端一定不能将Access-Control-Allow-Origin设置为*，而必须设置为请求页面的域名。</p>
<h3 id="xhr相关事件"><a href="#xhr相关事件" class="headerlink" title="xhr相关事件"></a>xhr相关事件</h3><h4 id="事件分类"><a href="#事件分类" class="headerlink" title="事件分类"></a>事件分类</h4><p>xhr相关事件有很多，有时记起来还挺容易混乱。但当我了解了具体代码实现后，就容易理清楚了。下面是XMLHttpRequest的部分实现代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">interface XMLHttpRequestEventTarget : EventTarget &#123;</span><br><span class="line">  <span class="comment">// event handlers</span></span><br><span class="line">  attribute EventHandler onloadstart;</span><br><span class="line">  attribute EventHandler onprogress;</span><br><span class="line">  attribute EventHandler onabort;</span><br><span class="line">  attribute EventHandler onerror;</span><br><span class="line">  attribute EventHandler onload;</span><br><span class="line">  attribute EventHandler ontimeout;</span><br><span class="line">  attribute EventHandler onloadend;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface XMLHttpRequestUpload : XMLHttpRequestEventTarget &#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface XMLHttpRequest : XMLHttpRequestEventTarget &#123;</span><br><span class="line">  <span class="comment">// event handler</span></span><br><span class="line">  attribute EventHandler onreadystatechange;</span><br><span class="line">  readonly attribute XMLHttpRequestUpload upload;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>从代码中我们可以看出：</p>
<p><font color="#F57170">XMLHttpRequest</font>EventTarget接口定义了7个事件：</p>
<pre><code>- onloadstart
- onprogress
- onabort
- ontimeout
- onerror
- onload
- onloadend
</code></pre><p>每一个<font color="#F57170">XMLHttpRequest</font>里面都有一个upload属性，而upload是一个<font color="#F57170">XMLHttpRequest</font>Upload对象</p>
<p><font color="#F57170">XMLHttpRequest</font>和<font color="#F57170">XMLHttpRequest</font>Upload都继承了同一个<font color="#F57170">XMLHttpRequest</font>EventTarget接口，所以xhr和xhr.upload都有第一条列举的7个事件<br>onreadystatechange是<font color="#F57170">XMLHttpRequest</font>独有的事件</p>
<p>所以这么一看就很清晰了：</p>
<p>xhr一共有8个相关事件：7个<font color="#F57170">XMLHttpRequest</font>EventTarget事件+1个独有的onreadystatechange事件；而xhr.upload只有7个<font color="#F57170">XMLHttpRequest</font>EventTarget事件。</p>
<h4 id="事件触发条件"><a href="#事件触发条件" class="headerlink" title="事件触发条件"></a>事件触发条件</h4><p><img src="http://os965hewa.bkt.clouddn.com/trigger.png" alt="trigger"></p>
<h4 id="事件触发顺序"><a href="#事件触发顺序" class="headerlink" title="事件触发顺序"></a>事件触发顺序</h4><p>当请求一切正常时，相关的事件触发顺序如下：</p>
<pre><code>- 触发xhr.onreadystatechange(之后每次readyState变化时，都会触发一次)
- 触发xhr.onloadstart
- //上传阶段开始：
- 触发xhr.upload.onloadstart
- 触发xhr.upload.onprogress
- 触发xhr.upload.onload
- 触发xhr.upload.onloadend
- //上传结束，下载阶段开始：
- 触发xhr.onprogress
- 触发xhr.onload
- 触发xhr.onloadend
- 发生abort/timeout/error异常的处理
</code></pre><p>在请求的过程中，有可能发生 abort/timeout/error这3种异常。那么一旦发生这些异常，xhr后续会进行哪些处理呢？后续处理如下：</p>
<pre><code>- 一旦发生abort或timeout或error异常，先立即中止当前请求
- 将 readystate 置为4，并触发 xhr.onreadystatechange事件
- 如果上传阶段还没有结束，则依次触发以下事件：
- xhr.upload.onprogress
- xhr.upload.[onabort或ontimeout或onerror]
- xhr.upload.onloadend
- 触发 xhr.onprogress事件
- 触发 xhr.[onabort或ontimeout或onerror]事件
- 触发xhr.onloadend 事件
- 在哪个xhr事件中注册成功回调？
</code></pre><p>从上面介绍的事件中，可以知道若xhr请求成功，就会触发xhr.onreadystatechange和xhr.onload两个事件。 那么我们到底要将成功回调注册在哪个事件中呢？我倾向于 xhr.onload事件，因为xhr.onreadystatechange是每次xhr.readyState变化时都会触发，而不是xhr.readyState=4时才触发。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//如果请求成功</span></span><br><span class="line">    <span class="keyword">if</span>(xhr.status == <span class="number">200</span>)&#123;</span><br><span class="line">      <span class="comment">//do successCallback</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的示例代码是很常见的写法：先判断http状态码是否是200，如果是，则认为请求是成功的，接着执行成功回调。这样的判断是有坑儿的，比如当返回的http状态码不是200，而是201时，请求虽然也是成功的，但并没有执行成功回调逻辑。所以更靠谱的判断方法应该是：当http状态码为2xx或304时才认为成功。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//如果请求成功</span></span><br><span class="line">  <span class="keyword">if</span>((xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt; <span class="number">300</span>) || xhr.status == <span class="number">304</span>)&#123;</span><br><span class="line">    <span class="comment">//do successCallback</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>扩展学习资料，如果你：</p>
<p>想真正搞懂<font color="#F57170">XMLHttpRequest</font>，最靠谱的方法还是看 <a href="https://www.w3.org/TR/XMLHttpRequest/" target="_blank" rel="noopener">W3C的xhr</a> 标准;<br>想粗略的了解<font color="#F57170">XMLHttpRequest</font>的基本使用，可以参考MDN的<font color="#F57170">XMLHttpRequest</font><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">介绍</a>；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/05/16/web网络之HTTP协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/web网络之HTTP协议/" itemprop="url">web网络之HTTP协议</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-16T17:33:19+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="导语"><a href="#导语" class="headerlink" title="导语"></a>导语</h3><p>网络知识是前端的必备技能，毕竟是要跟服务端打交道的。web网络体系中，前端使用最频繁，与前端关系最为密切的当属HTTP协议了。其实在工作中一直在使用HTTP协议，不过因为缺少一次汇总，总觉得印象不是很全，那就来总结一下吧。</p>
<h3 id="先从定义开始"><a href="#先从定义开始" class="headerlink" title="先从定义开始"></a>先从定义开始</h3><p>HTTP协议是<code>Hyper Text Transfer Protocol</code>（超文本传输协议）的缩写，基于<code>TCP/IP</code>通信协议来传递数据。</p>
<p>HTTP是一个属于应用层的面向对象的协议，HTTP协议工作于客户端-服务端架构上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送请求。Web服务器根据接收到的请求后，向客户端发送响应信息。</p>
<h3 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h3><p>1、简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。  </p>
<p>2、灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。  </p>
<p>3、无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。</p>
<p>4、无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。  </p>
<h3 id="URI和URL"><a href="#URI和URL" class="headerlink" title="URI和URL"></a>URI和URL</h3><h4 id="URI和URL的定义"><a href="#URI和URL的定义" class="headerlink" title="URI和URL的定义"></a>URI和URL的定义</h4><p>HTTP使用统一资源标识符（Uniform Resource Identifiers， URI）来传输数据和建立连接。URL是一种特殊类型的URI，包含了用于查找某个资源的足够的信息</p>
<p>URL，全称是<code>UniformResourceLocator</code>， 中文叫统一资源定位符，是互联网上用来标识某一处资源的地址。以下面这个URL为例，介绍下普通URL的各部分组成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.rulifun.com:8080/news/index.asp?boardID=5&amp;ID=24618&amp;page=1#name</span><br></pre></td></tr></table></figure>
<p>从上面的URL可以看出，一个完整的URL包括以下几部分：</p>
<p>1.协议部分：该URL的协议部分为“<code>http：</code>”，这代表网页使用的是HTTP协议。在Internet中可以使用多种协议，如HTTP，FTP等等本例中使用的是HTTP协议。在”HTTP”后面的“<code>//</code>”为分隔符</p>
<p>2.域名部分：该URL的域名部分为“<code>www.rulifun.com</code>”。一个URL中，也可以使用IP地址作为域名使用</p>
<p>3.端口部分：跟在域名后面的是端口，域名和端口之间使用“<code>:</code>”作为分隔符。端口不是一个URL必须的部分，如果省略端口部分，将采用默认端口</p>
<p>4.虚拟目录部分：从域名后的第一个“<code>/</code>”开始到最后一个“<code>/</code>”为止，是虚拟目录部分。虚拟目录也不是一个URL必须的部分。本例中的虚拟目录是“<code>/news/</code>”</p>
<p>5.文件名部分：从域名后的最后一个“<code>/</code>”开始到“<code>？</code>”为止，是文件名部分，如果没有“<code>?</code>”，则是从域名后的最后一个“<code>/</code>”开始到“<code>#</code>”为止，是文件部分，如果没有“<code>？</code>”和“<code>#</code>”，那么从域名后的最后一个“<code>/</code>”开始到结束，都是文件名部分。本例中的文件名是“<code>index.asp</code>”。文件名部分也不是一个URL必须的部分，如果省略该部分，则使用默认的文件名</p>
<p>6.锚部分：从“<code>#</code>”开始到最后，都是锚部分。本例中的锚部分是“<code>name</code>”。锚部分也不是一个URL必须的部分</p>
<p>7.参数部分：从“<code>？</code>”开始到“<code>#</code>”为止之间的部分为参数部分，又称搜索部分、查询部分。本例中的参数部分为“`boardID=5&amp;ID=24618&amp;page=1”。参数可以允许有多个参数，参数与参数之间用“&amp;”作为分隔符。</p>
<h4 id="URI和URL的区别"><a href="#URI和URL的区别" class="headerlink" title="URI和URL的区别"></a>URI和URL的区别</h4><p><strong>URI</strong>，是<code>uniform resource identifier</code>，<strong>统一资源标识符</strong>，用来唯一的标识一个资源。</p>
<p>Web上可用的每种资源如HTML文档、图像、视频片段、程序等都是一个来URI来定位的</p>
<p>URI一般由三部组成：</p>
<p>①访问资源的命名机制<br>②存放资源的主机名<br>③资源自身的名称，由路径表示，着重强调于资源。</p>
<p><strong>URL</strong>，是<code>uniform resource locator</code>，<strong>统一资源定位器</strong>，它是一种具体的URI，即URL可以用来标识一个资源，而且还指明了如何locate这个资源。</p>
<p>URL是Internet上用来描述信息资源的字符串，主要用在各种WWW客户程序和服务器程序上，特别是著名的Mosaic。</p>
<p>采用URL可以用一种统一的格式来描述各种信息资源，包括文件、服务器的地址和目录等。URL一般由三部组成：</p>
<p>①协议(或称为服务方式)<br>②存有该资源的主机IP地址(有时也包括端口号)<br>③主机资源的具体地址。如目录和文件名等</p>
<p>顺便一提的URN，uniform resource name，统一资源命名，是通过名字来标识资源，比如mailto:<a href="mailto:java-net@java.sun.com" target="_blank" rel="noopener">java-net@java.sun.com</a>。</p>
<p>URI是以一种抽象的，高层次概念定义统一资源标识，而URL和URN则是具体的资源标识的方式。URL和URN都是一种URI。笼统地说，每个 URL 都是 URI，但不一定每个 URI 都是 URL。这是因为 URI 还包括一个子类，即统一资源名称 (URN)，它命名资源但不指定如何定位资源。上面的 mailto、news 和 isbn URI 都是 URN 的示例。</p>
<p>一个URI可以是绝对的，也可以是相对的，只要它符合URI的语法规则。而URL类则不仅符合语义，还包含了定位该资源的信息，因此它不能是相对的。</p>
<p>URI类不包含任何访问资源的方法，它唯一的作用就是解析。相反的是，URL类可以打开一个到达资源的流。</p>
<h3 id="HTTP之请求消息Request"><a href="#HTTP之请求消息Request" class="headerlink" title="HTTP之请求消息Request"></a>HTTP之请求消息Request</h3><p>客户端发送一个HTTP请求到服务器的请求消息包括以下格式：</p>
<p>请求行（request line）、请求头部（header）、空行和请求数据四个部分组成。</p>
<p><img src="http://os965hewa.bkt.clouddn.com/Http%E8%AF%B7%E6%B1%82%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84.png" alt="Http请求消息结构.png"></p>
<p>Get请求例子，使用Charles抓取的request：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /<span class="number">562</span>f25980001b1b106000338.jpg HTTP/<span class="number">1.1</span></span><br><span class="line">Host    img.mukewang.com</span><br><span class="line">User-Agent    Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64) AppleWebKit/<span class="number">537.36</span> (KHTML， like Gecko) Chrome/<span class="number">51.0</span><span class="number">.2704</span><span class="number">.106</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept    image/webp，image<span class="comment">/*，*/</span>*;q=<span class="number">0.8</span></span><br><span class="line">Referer    http:<span class="comment">//www.imooc.com/</span></span><br><span class="line">Accept-Encoding    gzip， deflate， sdch</span><br><span class="line">Accept-Language    zh-CN，zh;q=<span class="number">0.8</span></span><br></pre></td></tr></table></figure>
<p>第一部分：请求行，用来说明请求类型，要访问的资源以及所使用的HTTP版本.</p>
<p>GET说明请求类型为GET，[/562f25980001b1b106000338.jpg]为要访问的资源，该行的最后一部分说明使用的是HTTP1.1版本。</p>
<p>第二部分：请求头部，紧接着请求行（即第一行）之后的部分，用来说明服务器要使用的附加信息</p>
<p>从第二行起为请求头部，HOST将指出请求的目的地.User-Agent，服务器端和客户端脚本都能访问它，它是浏览器类型检测逻辑的重要基础.该信息由你的浏览器来定义，并且在每个请求中自动发送等等</p>
<p>第三部分：空行，请求头部后面的空行是必须的</p>
<p>即使第四部分的请求数据为空，也必须有空行。</p>
<p>第四部分：请求数据也叫主体，可以添加任意的其他数据。</p>
<p>这个例子的请求数据为空。</p>
<p>POST请求例子，使用Charles抓取的request：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP1<span class="number">.1</span></span><br><span class="line">Host:www.wrox.com</span><br><span class="line">User-Agent:Mozilla/<span class="number">4.0</span> (compatible; MSIE <span class="number">6.0</span>; Windows NT <span class="number">5.1</span>; SV1; .NET CLR <span class="number">2.0</span><span class="number">.50727</span>; .NET CLR <span class="number">3.0</span><span class="number">.04506</span><span class="number">.648</span>; .NET CLR <span class="number">3.5</span><span class="number">.21022</span>)</span><br><span class="line">Content-Type:application/x-www-form-urlencoded</span><br><span class="line">Content-Length:<span class="number">40</span></span><br><span class="line">Connection: Keep-Alive</span><br><span class="line"></span><br><span class="line">name=Professional%<span class="number">20</span>Ajax&amp;publisher=Wiley</span><br></pre></td></tr></table></figure>
<p>第一部分：请求行，第一行明了是post请求，以及http1.1版本。<br>第二部分：请求头部，第二行至第六行。<br>第三部分：空行，第七行的空行。<br>第四部分：请求数据，第八行。</p>
<h3 id="HTTP之响应消息Response"><a href="#HTTP之响应消息Response" class="headerlink" title="HTTP之响应消息Response"></a>HTTP之响应消息Response</h3><p>一般情况下，服务器接收并处理客户端发过来的请求后会返回一个HTTP的响应消息。</p>
<p>HTTP响应也由四个部分组成，分别是：状态行、消息报头、空行和响应正文。</p>
<p><img src="http://os965hewa.bkt.clouddn.com/http%E5%93%8D%E5%BA%94%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F.jpg" alt="http响应消息格式.jpg"></p>
<p>例子<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="built_in">Date</span>: Fri， <span class="number">22</span> May <span class="number">2009</span> <span class="number">06</span>:<span class="number">07</span>:<span class="number">21</span> GMT</span><br><span class="line">Content-Type: text/html; charset=UTF<span class="number">-8</span></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">      &lt;head&gt;<span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line">      &lt;body&gt;</span><br><span class="line">            &lt;!--body goes here--&gt;</span><br><span class="line">      &lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure></p>
<p>第一部分：状态行，由HTTP协议版本号， 状态码， 状态消息 三部分组成。</p>
<p>第一行为状态行，（HTTP/1.1）表明HTTP版本为1.1版本，状态码为200，状态消息为（ok）</p>
<p>第二部分：消息报头，用来说明客户端要使用的一些附加信息</p>
<p>第二行和第三行为消息报头，<br>Date:生成响应的日期和时间；Content-Type:指定了MIME类型的HTML(text/html)，编码类型是UTF-8</p>
<p>第三部分：空行，消息报头后面的空行是必须的</p>
<p>第四部分：响应正文，服务器返回给客户端的文本信息。</p>
<p>空行后面的html部分为响应正文。</p>
<h3 id="HTTP之状态码"><a href="#HTTP之状态码" class="headerlink" title="HTTP之状态码"></a>HTTP之状态码</h3><p>状态代码有三位数字组成，第一个数字定义了响应的类别，共分五种类别:</p>
<p><strong>1xx</strong>：指示信息–表示请求已接收，继续处理</p>
<p><strong>2xx</strong>：成功–表示请求已被成功接收、理解、接受</p>
<p><strong>3xx</strong>：重定向–要完成请求必须进行更进一步的操作</p>
<p><strong>4xx</strong>：客户端错误–请求有语法错误或请求无法实现</p>
<p><strong>5xx</strong>：服务器端错误–服务器未能实现合法的请求</p>
<p>常见状态码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">200 OK                        //客户端请求成功</span><br><span class="line">400 Bad Request               //客户端请求有语法错误，不能被服务器所理解</span><br><span class="line">401 Unauthorized              //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 </span><br><span class="line">403 Forbidden                 //服务器收到请求，但是拒绝提供服务</span><br><span class="line">404 Not Found                 //请求资源不存在，eg：输入了错误的URL</span><br><span class="line">500 Internal Server Error     //服务器发生不可预期的错误</span><br><span class="line">503 Server Unavailable        //服务器当前不能处理客户端的请求，一段时间后可能恢复正常</span><br></pre></td></tr></table></figure></p>
<p>更多状态码 <a href="http://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">http://www.runoob.com/http/http-status-codes.html</a></p>
<h3 id="HTTP请求方法"><a href="#HTTP请求方法" class="headerlink" title="HTTP请求方法"></a>HTTP请求方法</h3><p>根据HTTP标准，HTTP请求可以使用多种请求方法。<br>HTTP1.0定义了三种请求方法： GET， POST 和 HEAD方法。<br>HTTP1.1新增了五种请求方法：OPTIONS， PUT， DELETE， TRACE 和 CONNECT 方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET     请求指定的页面信息，并返回实体主体。</span><br><span class="line">HEAD     类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</span><br><span class="line">POST     向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。</span><br><span class="line">PUT     从客户端向服务器传送的数据取代指定的文档的内容。</span><br><span class="line">DELETE      请求服务器删除指定的页面。</span><br><span class="line">CONNECT     HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</span><br><span class="line">OPTIONS     允许客户端查看服务器的性能。</span><br><span class="line">TRACE     回显服务器收到的请求，主要用于测试或诊断。</span><br></pre></td></tr></table></figure>
<h3 id="HTTP工作原理"><a href="#HTTP工作原理" class="headerlink" title="HTTP工作原理"></a>HTTP工作原理</h3><p>HTTP协议定义Web客户端如何从Web服务器请求Web页面，以及服务器如何把Web页面传送给客户端。HTTP协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。</p>
<p>以下是 HTTP 请求/响应的步骤：</p>
<p>1、客户端连接到Web服务器</p>
<p>一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。例如，<a href="http://www.rulifun.com" target="_blank" rel="noopener">http://www.rulifun.com</a></p>
<p>2、发送HTTP请求</p>
<p>通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据4部分组成。</p>
<p>3、服务器接受请求并返回HTTP响应</p>
<p>Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据4部分组成。</p>
<p>4、释放连接TCP连接</p>
<p>若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;</p>
<p>5、客户端浏览器解析HTML内容</p>
<p>客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。</p>
<p>例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：</p>
<p>1、浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;</p>
<p>2、解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;</p>
<p>3、浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;</p>
<p>4、服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;</p>
<p>5、释放 TCP连接;</p>
<p>6、浏览器将该 html 文本并显示内容; 　　</p>
<h3 id="GET和POST请求的区别"><a href="#GET和POST请求的区别" class="headerlink" title="GET和POST请求的区别"></a>GET和POST请求的区别</h3><p>GET请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /books/?sex=man&amp;name=Professional HTTP/1.1</span><br><span class="line">Host: www.wrox.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</span><br><span class="line">Gecko/20050225 Firefox/1.0.1</span><br><span class="line">Connection: Keep-Alive</span><br></pre></td></tr></table></figure></p>
<p>注意最后一行是空行</p>
<p>POST请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: www.wrox.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7.6)</span><br><span class="line">Gecko/20050225 Firefox/1.0.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 40</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line"></span><br><span class="line">name=Professional%20Ajax&amp;publisher=Wiley</span><br></pre></td></tr></table></figure></p>
<p>1、GET提交，请求的数据会附在URL之后（就是把数据放置在HTTP协议头中），以?分割URL和传输数据，多个参数用&amp;连接；例 如：login.action?name=hyddd&amp;password=idontknow&amp;verify=%E4%BD%A0 %E5%A5%BD。如果数据是英文字母/数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密，得出如： %E4%BD%A0%E5%A5%BD，其中％XX中的XX为该符号以16进制表示的ASCII。</p>
<p>POST提交：把提交的数据放置在是HTTP包的包体中。上文示例中红色字体标明的就是实际的传输数据</p>
<p>因此，GET提交的数据会在地址栏中显示出来，而POST提交，地址栏不会改变</p>
<p>2、传输数据的大小：首先声明：HTTP协议没有对传输的数据大小进行限制，HTTP协议规范也没有对URL长度进行限制。</p>
<p>而在实际开发中存在的限制主要有：</p>
<p>GET:特定浏览器和服务器对URL长度有限制，例如 IE对URL长度的限制是2083字节(2K+35)。对于其他浏览器，如Netscape、FireFox等，理论上没有长度限制，其限制取决于操作系 统的支持。</p>
<p>因此对于GET提交时，传输数据就会受到URL长度的 限制。</p>
<p>POST:由于不是通过URL传值，理论上数据不受 限。但实际各个WEB服务器会规定对post提交数据大小进行限制，Apache、IIS6都有各自的配置。</p>
<p>3、安全性</p>
<p>POST的安全性要比GET的安全性高。比如：通过GET提交数据，用户名和密码将明文出现在URL上，因为(1)登录页面有可能被浏览器缓存；(2)其他人查看浏览器的历史纪录，那么别人就可以拿到你的账号和密码了，除此之外，使用GET提交数据还可能会造成Cross-site request forgery攻击</p>
<p>4、Http get，post，soap协议都是在http上运行的</p>
<p>（1）get：请求参数是作为一个key/value对的序列（查询字符串）附加到URL上的<br>查询字符串的长度受到web浏览器和web服务器的限制（如IE最多支持2048个字符），不适合传输大型数据集同时，它很不安全</p>
<p>（2）post：请求参数是在http标题的一个不同部分（名为entity body）传输的，这一部分用来传输表单信息，因此必须将Content-type设置为:application/x-www-form- urlencoded。post设计用来支持web窗体上的用户字段，其参数也是作为key/value对传输。<br>但是：它不支持复杂数据类型，因为post没有定义传输数据结构的语义和规则。</p>
<p>（3）soap：是http post的一个专用版本，遵循一种特殊的xml消息格式<br>Content-type设置为: text/xml 任何数据都可以xml化。</p>
<p>Http协议定义了很多与服务器交互的方法，最基本的有4种，分别是GET，POST，PUT，DELETE. 一个URL地址用于描述一个网络上的资源，而HTTP中的GET， POST， PUT， DELETE就对应着对这个资源的查，改，增，删4个操作。 我们最常见的就是GET和POST了。GET一般用于获取/查询资源信息，而POST一般用于更新资源信息.</p>
<p>我们看看GET和POST的区别</p>
<p>GET提交的数据会放在URL之后，以?分割URL和传输数据，参数之间以&amp;相连，如EditPosts.aspx?name=test1&amp;id=123456. POST方法是把提交的数据放在HTTP包的Body中.</p>
<p>GET提交的数据大小有限制（因为浏览器对URL的长度有限制），而POST方法提交的数据没有限制.</p>
<p>GET方式需要使用Request.QueryString来取得变量的值，而POST方式通过Request.Form来获取变量的值。</p>
<p>GET方式提交数据，会带来安全问题，比如一个登录页面，通过GET方式提交数据时，用户名和密码将出现在URL上，如果页面可以被缓存或者其他人可以访问这台机器，就可以从历史记录获得该用户的账号和密码.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/05/15/Angular4项目环境和UI框架搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/15/Angular4项目环境和UI框架搭建/" itemprop="url">Angular4项目环境和UI框架搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-15T20:38:44+08:00">
                2017-05-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Angular/" itemprop="url" rel="index">
                    <span itemprop="name">Angular</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Angular4项目环境和UI框架搭建"><a href="#Angular4项目环境和UI框架搭建" class="headerlink" title="Angular4项目环境和UI框架搭建"></a>Angular4项目环境和UI框架搭建</h2><p>Angular4发布也有些时间了，之前angular2还是rc5版本的时候，公司曾经尝试过采用angular2作为前端框架，后来因为那时候的angular还不成熟，导致项目踩坑不断，以及团队上手难度大等原因，最后放弃了angular。不过也因为这一折腾，我倒是开阔了不少眼界，开始接触到前端的现代工作流。话不多说，重拾angular，先从项目环境搭建开始吧~</p>
<h3 id="angular-cli"><a href="#angular-cli" class="headerlink" title="angular-cli"></a>angular-cli</h3><p>angular也有自己的脚手架，十分推荐使用angular-cli，对于一些繁琐重复的配置都帮你解决了。有时候环境配置问题最烦人了，往往找半天还很难解决，最后按照官方的配置一下就好了，也学不到什么，能用工具解决就不要麻烦双手了。</p>
<p>因为我国的特殊情况，安装依赖时推荐使用cnpm代替npm。它很适合不能科学上网的开发者，cnpm也是npm包，自然也用npm安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g cnpm</span><br></pre></td></tr></table></figure>
<p>全局安装cnpm后，可以使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm version</span><br></pre></td></tr></table></figure></p>
<p>查看版本，检验是否安装成功。然后使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i -g @angular/cli</span><br></pre></td></tr></table></figure></p>
<p>进行全局的angular-cli安装。</p>
<p>如果想使用原生的npm进行安装的话，你可能会遇到以下几个坑：</p>
<ul>
<li>需要科学上网</li>
<li>需要python环境</li>
<li>需要解决nodo-sass和nod-gyp等一些模块不能正确安装问题</li>
</ul>
<p>cnpm对这些问题做了一些解决工作，所以对于新手还是推荐使用cnpm，不然搭个环境都要觉得累觉不爱了。</p>
<p>装好以后，可以使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng <span class="built_in">help</span></span><br></pre></td></tr></table></figure></p>
<p>来查看angular-cli命令。</p>
<h3 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h3><p>使用angular-cli创建项目也十分方便，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ng new 你的项目名称  // 这一步在安装node_module时耗时可能较长</span><br><span class="line"><span class="built_in">cd</span> 你的项目名称</span><br><span class="line">ng serve</span><br></pre></td></tr></table></figure></p>
<p>顺利的话，最初始的angular项目会在 <a href="http://localhost:4200" target="_blank" rel="noopener">http://localhost:4200</a> 上跑起来了，这里可以使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng serve --port 端口号</span><br></pre></td></tr></table></figure></p>
<p>来指定项目本地运行的端口，还可以使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng serve --prod --aot</span><br></pre></td></tr></table></figure></p>
<p>来启用压缩等项目优化。</p>
<h3 id="使用ng命令"><a href="#使用ng命令" class="headerlink" title="使用ng命令"></a>使用ng命令</h3><p>angular由根模块和其它模块构成，模块里面包含组件、指令、服务和管道等可以复用的类。使用ng命令可以快速的生成这些类。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ng g component my-new-component   // 生成组件</span><br><span class="line">ng g directive my-new-directive   // 生成指令</span><br><span class="line">ng g pipe my-new-pipe             // 管道</span><br><span class="line">ng g service my-new-service       // 服务</span><br><span class="line">ng g class my-new-class           // 类</span><br><span class="line">ng g guard my-new-guard           // 路由守卫</span><br><span class="line">ng g interface my-new-interface   // 接口</span><br><span class="line">ng g enum my-new-enum             // 枚举类型</span><br><span class="line">ng g module my-module             // 模块</span><br></pre></td></tr></table></figure>
<p>这些命令会根据当前路径或者指定的路径管理归属关系，比如当前模块下新建的组件属于当前模块，自动在当前模块进行import和declarations：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 支持相对路径和绝对路径</span></span><br><span class="line"><span class="comment"># 当前路径为：src/app/feature/</span></span><br><span class="line">ng g component new-cmp</span><br><span class="line"><span class="comment"># 组件生成路径为：src/app/feature/new-cmp</span></span><br><span class="line"><span class="comment"># 指定路径</span></span><br><span class="line">ng g component ../newer-cmp</span><br><span class="line"><span class="comment"># 组件生成路径为：src/app/newer-cmp</span></span><br><span class="line"><span class="comment"># 在src/app下指定路径 </span></span><br><span class="line">ng g component feature/new-cmp</span><br><span class="line"><span class="comment"># 组件生成路径为：src/app/feature/new-cmp</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用UI框架"><a href="#使用UI框架" class="headerlink" title="使用UI框架"></a>使用UI框架</h3><p>到这一步angular项目环境已经搭建完成了，但是使用框架总离不开UI框架，UI环境都没搭这个项目也太简陋了。或许你对bootstrap情有独钟，那么可以用ng2-bootstrap，除此之外也有Prime-NG，ionic等可以选择。但是，跟angular最配的还是要属google主导的Material design，Material说起来也是一个大主题，这里先推荐俩个materialUI框架，一个是<a href="https://material.angular.io/" target="_blank" rel="noopener">Angular-Material</a>，一个是<a href="http://mseemann.io/angular2-mdl/" target="_blank" rel="noopener">angular-mdl</a>。这里展示一下如何引入和使用这两个UI框架。</p>
<h4 id="Angular-Material"><a href="#Angular-Material" class="headerlink" title="Angular-Material"></a>Angular-Material</h4><p>第一步，安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save @angular/material</span><br></pre></td></tr></table></figure></p>
<p>第二步，使用：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;MdButtonModule, MdCheckboxModule&#125; <span class="keyword">from</span> <span class="string">'@angular/material'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  imports: [MdButtonModule, MdCheckboxModule],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> DemoModule &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>可能需要的步骤：</p>
<p>如果需要使用动画，要另外安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save @angular/animations</span><br></pre></td></tr></table></figure></p>
<p>使用时：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;BrowserAnimationsModule&#125; <span class="keyword">from</span> <span class="string">'@angular/platform-browser/animations'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  ...</span><br><span class="line">  imports: [BrowserAnimationsModule],</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> DemoModule &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>使用主题,在index.html添加<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"../node_modules/@angular/material/prebuilt-themes/indigo-pink.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>目前可以使用的配色较少，推荐使用material-design-lite，配色十分丰富，material-design-lite详见angular2-mdl部分。</p>
<p>一些UI组建依赖hammerjs,安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save hammerjs</span><br></pre></td></tr></table></figure></p>
<p>导入：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'hammerjs'</span>;</span><br></pre></td></tr></table></figure></p>
<p>使用UI组件时：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 组件的模板</span><br><span class="line"> <span class="tag">&lt;<span class="name">md-checkbox</span> <span class="attr">class</span>=<span class="string">"example-margin"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"checked"</span>&gt;</span>Checked<span class="tag">&lt;/<span class="name">md-checkbox</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Angular-Material目前还未开发完成，但是假以时日，目测会是一个十分优秀且适合angular的UI框架。我们可以先使用比较成熟的angular-mdl。</p>
<h4 id="angular-mdl"><a href="#angular-mdl" class="headerlink" title="angular-mdl"></a>angular-mdl</h4><p>angular-mdl也是基于material风格的UI框架，也算是比较成熟，目前推荐使用这款框架。首先是安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install @angular-mdl/core --save</span><br></pre></td></tr></table></figure></p>
<p>在需要使用的模块引入：<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; MdlModule &#125; <span class="keyword">from</span> <span class="string">'@angular-mdl/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    imports: [</span><br><span class="line">        ...</span><br><span class="line">        MdlModule,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>安装material-design-lite和material-icons<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install material-design-lite --save</span><br><span class="line">cnpm install material-icons --save</span><br></pre></td></tr></table></figure></p>
<p>在全局样式文件 style.css导入：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"../node_modules/material-design-lite/dist/material.blue-cyan.min.css"</span>;  </span><br><span class="line">@<span class="keyword">import</span> <span class="string">"../node_modules/material-design-icons/iconfont/material-icons.css"</span>;</span><br></pre></td></tr></table></figure>
<p>主题配色可以参考angular-mdl页面：<br><a href="http://mseemann.io/angular2-mdl/theme" target="_blank" rel="noopener">angular-mdl themes</a></p>
<p>使用UI组件时：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 组件的模板</span><br><span class="line"><span class="tag">&lt;<span class="name">mdl-textfield</span> <span class="attr">type</span>=<span class="string">"text"</span> [(<span class="attr">ngModel</span>)]=<span class="string">"theText"</span> <span class="attr">icon</span>=<span class="string">"search"</span>&gt;</span><span class="tag">&lt;/<span class="name">mdl-textfield</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>具体的使用效果可以到这些框架的官网上查看，我这里就不贴图了。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>使用angular-cli进行项目环境搭建还是比较容易的，针对国内特殊的网络环境，我们可以使用cnpm代替npm进行npm包的安装。对于一些重复繁琐的配置以及组件等一些类的生成，angular-cli都提供了比较方便的实现，从而可以把精力放在开发上面而不是折腾环境配置。</p>
<p>UI是前端开发必不可少的，已经有了不少适配angular的UI框架，可以根据项目需求自行选择，这里再次安利一下material风格的UI。基于material风格的UI框架，本文介绍了<a href="https://material.angular.io/" target="_blank" rel="noopener">Angular-Material</a>和<a href="http://mseemann.io/angular2-mdl/" target="_blank" rel="noopener">angular-mdl</a>这两个UI框架如何引进到项目中使用，配合angular本身可以大幅提高开发的效率和质量。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/05/04/彻底搞懂JS比较运算符/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/04/彻底搞懂JS比较运算符/" itemprop="url">JS点滴：彻底搞懂比较运算符</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-04T21:05:22+08:00">
                2017-05-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="彻底搞懂JS比较运算符"><a href="#彻底搞懂JS比较运算符" class="headerlink" title="彻底搞懂JS比较运算符"></a>彻底搞懂JS比较运算符</h2><p>JS存在强制类型转换，让人觉得比较运算符的运算规则十分复杂，而且很容易判断出错。正好看到一篇文章，作者画的图实在是太形象了，贴出来给自己做个笔记：</p>
<p>JS中的值可以分为两类，一类是简单基本类型，也称为原始类型（Primitive）：</p>
<ul>
<li>Number：很多个，不是无限个</li>
<li>String：可以有无限个</li>
<li>Boolean：<code>true</code>和<code>false</code></li>
<li>Null: 只有一个值<code>null</code></li>
<li>Undefined: 只有一个值<code>undefined</code></li>
<li>Symbol（es6+）: 可以有无限个，每个都是独一无二的</li>
</ul>
<p>一类是对象（Object），所有对象都有<code>valueOf()</code>和<code>toString()</code>方法，它们继承自Object，当然也可能被子类重写。</p>
<h3 id="类型相同时"><a href="#类型相同时" class="headerlink" title="类型相同时"></a>类型相同时</h3><p>两个比较的值类型相同时，<code>==</code>等于<code>===</code>,这个比较好判断，不过也有几个规则：</p>
<ul>
<li>任何两个对象都不相等</li>
<li><p>NaN不等于它本身,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NaN</span> !== <span class="literal">NaN</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>任何两个Symbol都不相等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">Symbol</span>(<span class="string">'1'</span>), b = <span class="built_in">Symbol</span>(<span class="string">'1'</span>);</span><br><span class="line">a == b;  <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="类型不同时"><a href="#类型不同时" class="headerlink" title="类型不同时"></a>类型不同时</h3><p>类型不同时，就会发生类型（隐含）强制转换，直到可以判定结果。</p>
<p><img src="http://opmxohji9.bkt.clouddn.com/compare1.png" alt="==运算规则的图形化表示"><br>图1 ==运算规则的图形化表示</p>
<h4 id="有和无"><a href="#有和无" class="headerlink" title="有和无"></a>有和无</h4><p>在上图中，JavaScript值的六种类型用蓝底色的矩形表示。它们首先被分成了两组：</p>
<p>String、Number、Boolean和Object (对应左侧的大矩形框)</p>
<p>Undefined和Null (对应右侧的矩形框)</p>
<p>分组的依据是什么？我们来看一下，右侧的<code>Undefined</code>和<code>Null</code>是用来表示不确定、无或者空的，而右侧的四种类型都是确定的、有和非空。我们可以这样说：</p>
<p>左侧是一个存在的世界，右侧是一个空的世界。</p>
<p>所以，左右两个世界中的任意值做==比较的结果都是<code>false</code>是很合理的。(连接两个矩形的水平线上标的false)</p>
<h4 id="空和空"><a href="#空和空" class="headerlink" title="空和空"></a>空和空</h4><p>JavaScript中的undefined和null是另一个经常让我们崩溃的地方。通常它被认为是一个设计缺陷，这一点我们不去深究。不过我曾听说，JavaScript的作者最初是这样想的：</p>
<p>假如你打算把一个变量赋予对象类型的值，但是现在还没有赋值，那么你可以用null表示此时的状态(证据之一就是typeof null 的结果是’object’)；相反，假如你打算把一个变量赋予原始类型的值，但是现在还没有赋值，那么你可以用undefined表示此时的状态。</p>
<p>不管这个传闻是否可信，它们两者做==比较的结果是true是很合理的。(见图中右侧垂直线上标的true)</p>
<p>在进行下一步之前，我们先来说一下图1中的两个符号：大写字母N和P。这两个符号并不是PN结中正和负的意思。而是：</p>
<p>N表示ToNumber操作，即将操作数转为数字。它是规范中的抽象操作，但我们可以用JS中的Number()函数来等价替代。</p>
<p>P表示ToPrimitive操作，即将操作数转为原始类型的值。它也是规范中的抽象操作，同样也可以翻译成等价的JS代码。不过稍微复杂一些，简单说来，对于一个对象obj：</p>
<p>ToPrimitive(obj)等价于：先计算obj.valueOf()，如果结果为原始值，则返回此结果；否则，计算obj.toString()，如果结果是原始值，则返回此结果；否则，抛出异常。</p>
<p>注：此处有个例外，即Date类型的对象，它会先调用toString()方法，后调用valueOf()方法。</p>
<p>在图1中，标有N或P的线表示：当它连接的两种类型的数据做==运算时，标有N或P的那一边的操作数要先执行ToNumber或ToPrimitive变换。</p>
<h4 id="真与假"><a href="#真与假" class="headerlink" title="真与假"></a>真与假</h4><p>从图中可以看出，当布尔值与其他类型的值作比较时，布尔值会转化为数字，具体来说</p>
<p>true -&gt; 1<br>false -&gt; 0<br>这一点也不需浪费过多口舌。想一下在C语言中，根本没有布尔类型，通常用来表示逻辑真假的正是整数1和0。</p>
<h4 id="字符的序列"><a href="#字符的序列" class="headerlink" title="字符的序列"></a>字符的序列</h4><p>在图1中，我们把String和Number类型分成了一组。为什么呢？在六种类型中，String和Number都是字符的序列(至少在字面上如此)。字符串是所有合法的字符的序列，而数字可以看成是符合特定条件的字符的序列。所以，数字可以看成字符串的一个子集。</p>
<p>根据图1，在字符串和数字做==运算时，需要使用ToNumber操作，把字符串转化为数字。假设x是字符串，y是数字，那么：</p>
<p>x == y -&gt; Number(x) == y<br>那么字符串转化为数字的规则是怎样的呢？规范中描述得很复杂，但是大致说来，就是把字符串两边的空白字符去掉，然后把两边的引号去掉，看它能否组成一个合法的数字。如果是，转化结果就是这个数字；否则，结果是NaN。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>(<span class="string">'123'</span>) <span class="comment">// 结果123</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'1.2e3'</span>) <span class="comment">// 结果1200</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'123abc'</span>) <span class="comment">// 结果NaN</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'\r\n\t123\v\f'</span>) <span class="comment">// 结果123</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当然也有例外，比如空白字符串转化为数字的结果是0。即</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">''</span>) <span class="comment">// 结果0</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'\r\n\t \v\f'</span>) <span class="comment">// 结果0</span></span><br></pre></td></tr></table></figure>
<h4 id="单纯与复杂"><a href="#单纯与复杂" class="headerlink" title="单纯与复杂"></a>单纯与复杂</h4><p>原始类型是一种单纯的类型，它们直接了当、容易理解。然而缺点是表达能力有限，难以扩展，所以就有了对象。对象是属性的集合，而属性本身又可以是对象。所以对象可以被构造得任意复杂，足以表示各种各样的事物。</p>
<p>但是，有时候事情复杂了也不是好事。比如一篇冗长的论文，并不是每个人都有时间、有耐心或有必要从头到尾读一遍，通常只了解其中心思想就够了。于是论文就有了关键字、概述。JavaScript中的对象也一样，我们需要有一种手段了解它的主要特征，于是对象就有了toString()和valueOf()方法。</p>
<p>toString()方法用来得到对象的一段文字描述；而valueOf()方法用来得到对象的特征值。</p>
<p>当然，这只是我自己的理解。顾名思义，toString()方法倾向于返回一个字符串。那么valueOf()方法呢？根据规范中的描述，它倾向于返回一个数字——尽管内置类型中，valueOf()方法返回数字的只有Number和Date。</p>
<p>根据图1，当一个对象与一个非对象比较时，需要将对象转化为原始类型(虽然与布尔类型比较时，需要先将布尔类型变成数字类型，但是接下来还是要将对象类型变成原始类型)。这也是合理的，毕竟==是不严格的相等比较，我们只需要取出对象的主要特征来参与运算，次要特征放在一边就行了。</p>
<h4 id="万物皆数"><a href="#万物皆数" class="headerlink" title="万物皆数"></a>万物皆数</h4><p>我们回过头来看一下图1。里面标有N或P的那几条连线是没有方向的。假如我们在这些线上标上箭头，使得连线从标有N或P的那一端指向另一端，那么会得到(不考虑undefined和null)：</p>
<p><img src="http://opmxohji9.bkt.clouddn.com/compare2.png" alt="==运算过程中类型转化的趋势"><br>图2 ==运算过程中类型转化的趋势</p>
<p>发现什么了吗？对，在运算过程中，所有类型的值都有一种向数字类型转化的趋势。毕竟曾经有名言曰：</p>
<blockquote>
<p>万物皆数。万物皆数是毕达哥拉斯学派认为一切都可用”自然数”衡量的观点.毕达哥拉斯的学生XX(不好意思,忘了名字)这个发现了无理数的倒霉家伙被扔到海里淹死了(老师没人性啊),但他打破了自然数可以衡量一切”量”的关系的理念。</p>
</blockquote>
<h3 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h3><p>前面废话太多了，这里还是举个例子，来证明图1确实是方便有效可以指导实践的。</p>
<p>例，计算下面表达式的值：</p>
<pre><code>[&apos;&apos;] == false
</code></pre><p>首先，两个操作数分别是对象类型、布尔类型。根据图1，需要将布尔类型转为数字类型，而false转为数字的结果是0，所以表达式变为：</p>
<pre><code>[&apos;&apos;] == 0
</code></pre><p>两个操作数变成了对象类型、数字类型。根据图1，需要将对象类型转为原始类型：</p>
<p>首先调用[].valueOf()，由于数组的valueOf()方法返回自身，所以结果不是原始类型，继续调用[].toString()。</p>
<p>对于数组来说，toString()方法的算法，是将每个元素都转为字符串类型，然后用逗号’,’依次连接起来，所以最终结果是空字符串’’，它是一个原始类型的值。</p>
<p>此时，表达式变为：</p>
<pre><code>&apos;&apos; == 0
</code></pre><p>两个操作数变成了字符串类型、数字类型。根据图1，需要将字符串类型转为数字类型，前面说了空字符串变成数字是0。于是表达式变为：</p>
<pre><code>0 == 0
</code></pre><p>到此为止，两个操作数的类型终于相同了，结果明显是true。</p>
<p>从这个例子可以看出，要想掌握==运算的规则，除了牢记图1外，还需要记住那些内置对象的toString()和valueOf()方法的规则。包括Object、Array、Date、Number、String、Boolean等，幸好这没有什么难度。</p>
<h3 id="再次变形"><a href="#再次变形" class="headerlink" title="再次变形"></a>再次变形</h3><p>其实，图一还不够完美。为什么呢？因为对象与字符串/数字比较时都由对象来转型，但是与同样是原始类型的布尔类型比较时却需要布尔类型转型。实际上，只要稍稍分析一下，全部让对象来转为原始类型也是等价的。所以我们得到了最终的更加完美的图形：</p>
<p><img src="http://opmxohji9.bkt.clouddn.com/compare3.png" alt="更完美的==运算规则的图形化表示"><br>图3 更完美的==运算规则的图形化表示</p>
<p>有一个地方可能让你疑惑：为什么Boolean与String之间标了两个N？虽然按照规则应该是由Boolean转为数字，但是下一步String就要转为数字了，所以干脆不如两边同时转成数字。</p>
<h3 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h3><p>前面说得很乱，根据我们得到的最终的图3，我们总结一下==运算的规则：</p>
<p>undefined == null，结果是true。且它俩与所有其他值比较的结果都是false。</p>
<p>String == Boolean，需要两个操作数同时转为Number。</p>
<p>String/Boolean == Number，需要String/Boolean转为Number。</p>
<p>Object == Primitive，需要Object转为Primitive(具体通过valueOf和toString方法)。</p>
<p>瞧见没有，一共只有4条规则！是不是很清晰、很简单。</p>
<p><img src="http://opmxohji9.bkt.clouddn.com/compare4.png" alt=""></p>
<p><a href="https://zhuanlan.zhihu.com/p/21650547" target="_blank" rel="noopener">原文地址</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/04/26/You-don-t-konw-JS-类型与文法捡漏（2）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/26/You-don-t-konw-JS-类型与文法捡漏（2）/" itemprop="url">You don't konw JS: 类型与文法捡漏（2）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-26T22:01:21+08:00">
                2017-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="类型强制转换"><a href="#类型强制转换" class="headerlink" title="类型强制转换"></a>类型强制转换</h2><h3 id="隐含强制转换与明确强制转换"><a href="#隐含强制转换与明确强制转换" class="headerlink" title="隐含强制转换与明确强制转换"></a>隐含强制转换与明确强制转换</h3><p>明显是有意为之的，是“明确强制转换”；为其他操作而发生的，是“隐含强制转换”。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = a + <span class="string">""</span>;            <span class="comment">// 隐含强制转换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="built_in">String</span>( a );    <span class="comment">// 明确强制转换</span></span><br></pre></td></tr></table></figure>
<h3 id="抽象操作"><a href="#抽象操作" class="headerlink" title="抽象操作"></a>抽象操作</h3><p>值的变形规则定义了几种“抽象操作”,控制着值如何变成一个string，number，或boolean</p>
<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h4><p>对于普通的对象，默认的toString()将返回内部的[[Class]]；<br>对于数组，会将数组字符串化为它所有的值的字符串连接，并用”,”分割每个值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;<span class="string">'x'</span>:<span class="number">1</span>&#125;;</span><br><span class="line">a.toString(); <span class="comment">//"[object Object]"</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].toString(); <span class="comment">// "1,2,3"</span></span><br></pre></td></tr></table></figure></p>
<h4 id="JSON-stringify"><a href="#JSON-stringify" class="headerlink" title="JSON.stringify()"></a>JSON.stringify()</h4><p>对于简单值，基本上和toString()转换是相同的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify( <span class="number">42</span> );    <span class="comment">// "42"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( <span class="string">"42"</span> );    <span class="comment">// ""42"" （一个包含双引号的字符串）</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( <span class="literal">null</span> );    <span class="comment">// "null"</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( <span class="literal">true</span> );    <span class="comment">// "true"</span></span><br></pre></td></tr></table></figure>
<p>任何JSON安全的值都可以被JSON.stringify(..)字符串化。JSON安全指的是可以用JSON合法表达的值。undefined，function，（ES6+）symbol，和带有循环引用的object（属性互相引用而造成了一个永不终结的循环），对于标准的JSON结构来说这些都是非法的值，主要是因为它们不能移植到消费JSON值的其他语言中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.stringify( <span class="literal">undefined</span> );     <span class="comment">// undefined 对于undefined自动忽略</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; );  <span class="comment">// undefined 对于function自动忽略</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify( [<span class="number">1</span>,<span class="literal">undefined</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="number">4</span>] ); <span class="comment">// "[1,null,null,4]"，数组中的undefined和function替换成null</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify( &#123; <span class="attr">a</span>:<span class="number">2</span>, <span class="attr">b</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125; &#125; );      <span class="comment">// "&#123;"a":2&#125;"， 对象中的不合法属性被简单忽略</span></span><br></pre></td></tr></table></figure>
<p>如果一个object值定义了一个toJSON()方法，这个方法将会被首先调用，以取得用于序列化的值。toJSON()方法返回这个object的一个JSON安全版本。toJSON()并不是返回字符串，返回实际普通值（无论什么类型），而JSON.stringify(..)才处理字符串化。</p>
<p>JSON.stringify(..)的第二个参数值（array或function）是可选的，它提供一种过滤机制，决定哪些属性应该被包含在序列化形式中。</p>
<p>array：指定了允许被包含在这个object的序列化形式中的属性名称。如果一个属性不存在于这个列表中，那么它就会被跳过。</p>
<p>function：传入两个参数值，key 和 value。要在序列化中跳过一个 key，可以返回undefined。否则，就返回 value。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    b: <span class="number">42</span>,</span><br><span class="line">    c: <span class="string">"42"</span>,</span><br><span class="line">    d: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify( a, [<span class="string">"b"</span>,<span class="string">"c"</span>] ); <span class="comment">// "&#123;"b":42,"c":"42"&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify( a, <span class="function"><span class="keyword">function</span>(<span class="params">k,v</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k !== <span class="string">"c"</span>) <span class="keyword">return</span> v;</span><br><span class="line">&#125; );</span><br><span class="line"><span class="comment">// "&#123;"b":42,"d":[1,2,3]&#125;"</span></span><br></pre></td></tr></table></figure>
<p>JSON.stringify()还可以接收第三个可选参数值，被用做缩进。可以是一个正整数，用来指示每一级缩进中使用多少个空格字符。或者可以是一个string，这时每一级缩进将会使用它的前十个字符。</p>
<h4 id="Number"><a href="#Number" class="headerlink" title="Number()"></a>Number()</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// string</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'1'</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="string">'a'</span>); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// boolean</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">true</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">false</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">undefined</span>); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//null</span></span><br><span class="line"><span class="built_in">Number</span>(<span class="literal">null</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// obj</span></span><br><span class="line"><span class="built_in">Number</span>(&#123;&#125;); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// array</span></span><br><span class="line"><span class="built_in">Number</span>([]); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">Number</span>([<span class="number">1</span>]); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">Number</span>([<span class="number">1</span>,<span class="number">2</span>]); <span class="comment">// NaN</span></span><br></pre></td></tr></table></figure>
<p>对象（以及数组）将会首先进行ToPrimitive抽象操作，看它有没有valueOf()方法。如果valueOf()可用并且它返回一个基本类型值，那么这个值就将用于强制转换成数字。如果不是这样，但toString()可用，那么就由它来提供用于强制转换的值。如果这两种操作都没提供一个基本类型值，就会抛出一个TypeError。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">    valueOf: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"42"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">    toString: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"42"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = [<span class="number">4</span>,<span class="number">2</span>];</span><br><span class="line">c.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.join( <span class="string">""</span> );    <span class="comment">// "42"</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Number</span>( a );          <span class="comment">// 42 先调用valueOf(),返回的是基本类型值，转换成number</span></span><br><span class="line"><span class="built_in">Number</span>( b );          <span class="comment">// 42 没有valueOf(),调用String(),返回的是基本类型值，转换成number</span></span><br><span class="line"><span class="built_in">Number</span>( c );          <span class="comment">// 42 同上</span></span><br><span class="line"><span class="built_in">Number</span>( <span class="string">""</span> );         <span class="comment">// 0  </span></span><br><span class="line"><span class="built_in">Number</span>( [] );         <span class="comment">// 0 </span></span><br><span class="line"><span class="built_in">Number</span>( [ <span class="string">"abc"</span> ] );  <span class="comment">// NaN 先调用内置的valueOf()返回数组本身，接着toString()返回'abc',转换成number得到NaN</span></span><br></pre></td></tr></table></figure>
<h4 id="ToBoolean"><a href="#ToBoolean" class="headerlink" title="ToBoolean"></a>ToBoolean</h4><p>“falsy”值列表：</p>
<ul>
<li>undefined</li>
<li>null</li>
<li>false</li>
<li>0, -0, and NaN</li>
<li>‘’</li>
</ul>
<p>任何没有明确地存在于falsy列表中的东西，都是truthy。</p>
<p>falsy转换到boolean时为<code>false</code>,truthy为<code>true</code>；</p>
<h3 id="明确强制转换"><a href="#明确强制转换" class="headerlink" title="明确强制转换"></a>明确强制转换</h3><h4 id="gt-number"><a href="#gt-number" class="headerlink" title="-&gt; number"></a>-&gt; number</h4><ul>
<li>Number()</li>
<li>一元操作符<code>+</code></li>
<li>操作符 <code>~</code>：~x大致与-(x+1)相同，可以和indeOf()配合使用， <code>~~</code>可用于取整</li>
<li>parseInt(value[,radix]): 参数value是string，否则先转成string，参数radix可选，指定转化的进制。解析value时如果遇到非数字字符就停止解析。</li>
</ul>
<h4 id="gt-string"><a href="#gt-string" class="headerlink" title="-&gt; string"></a>-&gt; string</h4><ul>
<li>String()</li>
<li>toString()</li>
</ul>
<h4 id="gt-boolean"><a href="#gt-boolean" class="headerlink" title="-&gt; boolean"></a>-&gt; boolean</h4><ul>
<li>Boolean()</li>
</ul>
<h3 id="隐含强制转换"><a href="#隐含强制转换" class="headerlink" title="隐含强制转换"></a>隐含强制转换</h3><ul>
<li>相减时转换成number</li>
<li>相加时一个是string，则另一个转换成string</li>
<li>转换成boolean:<ul>
<li>在一个if (..)语句中的测试表达式。</li>
<li>在一个for ( .. ; .. ; .. )头部的测试表达式（第二个子句）。</li>
<li>在while (..)和do..while(..)循环中的测试表达式。</li>
<li>在? :三元表达式中的测试表达式（第一个子句）。</li>
<li>||（“逻辑或”）和&amp;&amp;（“逻辑与”）操作符左手边的操作数。</li>
</ul>
</li>
</ul>
<h3 id="宽松等价与严格等价"><a href="#宽松等价与严格等价" class="headerlink" title="宽松等价与严格等价"></a>宽松等价与严格等价</h3><p><code>==</code>允许在等价性比较中进行强制转换，而<code>===</code>不允许强制转换</p>
<h3 id="比较表达式中的类型转换"><a href="#比较表达式中的类型转换" class="headerlink" title="比较表达式中的类型转换"></a>比较表达式中的类型转换</h3><p>如果把js中的六种类型做一个划分，它们在比较运算中大概会采取以下措施：</p>
<p><img src="http://oohz6uxcv.bkt.clouddn.com/cpmpare1.PNG" alt=""></p>
<p>在运算过程中，所有类型的值都有一种向数字类型转化的趋势：</p>
<ul>
<li>右边的undefined和null和左边的任何一个都不相等</li>
<li>string和number：string转换成number然后再比较</li>
<li>boolean和number：boolean转换成number然后再比较</li>
<li>boolean和string：都转换成number</li>
<li>object和number：object先进行ToPrimitive抽象操作（valueOf()和toString()方法），然后转换成number</li>
<li>object和string（boolean）：都转换成number</li>
</ul>
<p>用图来表示大概就是这样子（P表示ToPrimitive，N表示Number()）：</p>
<p><img src="http://oohz6uxcv.bkt.clouddn.com/compare2.PNG" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/04/19/You-don-t-konw-JS-类型与文法捡漏（1）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/19/You-don-t-konw-JS-类型与文法捡漏（1）/" itemprop="url">You don't konw JS: 类型与文法捡漏（1）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-19T21:57:58+08:00">
                2017-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="类型与值"><a href="#类型与值" class="headerlink" title="类型与值"></a>类型与值</h1><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><h3 id="内建类型"><a href="#内建类型" class="headerlink" title="内建类型"></a>内建类型</h3><p>JavaScript定义了7种内建类型：</p>
<ul>
<li>null</li>
<li>undefined</li>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>object</li>
<li>symbol （es6）</li>
</ul>
<blockquote>
<p>除了object所有这些类型都被称为“基本类型”。</p>
</blockquote>
<p><code>typeof</code>操作符可以检测给定值的类型，但是返回值并不正好跟七个类型一一匹配，而是存在两种特殊情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span> <span class="literal">null</span> <span class="comment">// 'object' 意外的bug，当作特殊情况处理</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// 'function' 函数虽然也是对象，但是不返回'object', 而是'function'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>null是唯一一个“falsy”，但是在typeof检查中返回”object”的基本类型</p>
</blockquote>
<p>测试是否是null类型：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="literal">null</span>;</span><br><span class="line">(!a &amp;&amp; <span class="keyword">typeof</span> a === <span class="string">"object"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>对象的子类型：</p>
<ul>
<li>function</li>
<li>array</li>
<li>其它原生类型（String，Number，Boolean等等）</li>
</ul>
<p>变量没有类型 – 值才有类型。变量可以在任何时候，持有任何值。</p>
<p>如果你对一个变量使用typeof，它不会像表面上看起来那样询问“这个变量的类型是什么？”，因为JS变量是没有类型的。取而代之的是，它会询问“在这个变量里的值的类型是什么？”</p>
<h3 id="undefined-和-“undeclared”"><a href="#undefined-和-“undeclared”" class="headerlink" title="undefined 和 “undeclared”"></a>undefined 和 “undeclared”</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line">a; <span class="comment">// undefined, 已经声明过但是这时候没有值</span></span><br><span class="line">b; <span class="comment">// ReferenceError: b is not defined. 'undeclared',从未声明过</span></span><br></pre></td></tr></table></figure>
<p>虽然区别很大，但是JS中一定程度混淆了两者：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> a; <span class="comment">// "undefined"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typeof</span> b; <span class="comment">// "undefined"</span></span><br></pre></td></tr></table></figure></p>
<p>因为<code>typeof</code>对一个未声明的变量也返回”undefined”，这种安全防卫机制（防止一个错误）在特定的情况下非常有用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DEBUG 未声明</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这将抛出一个错误！</span></span><br><span class="line"><span class="keyword">if</span> (DEBUG) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Debugging is starting"</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个安全的存在性检查</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> DEBUG !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Debugging is starting"</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="值"><a href="#值" class="headerlink" title="值"></a>值</h2><h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><ul>
<li>数组成员可以是任何类型的值。</li>
<li><code>delete</code>操作符删除的是数组成员的值属性，数组长度不变。</li>
<li>“空值槽”不同于被明确设置（a[1] = undefined）的值槽。</li>
<li>虽然可以向数组添加属性，但是数组应该专注于数字索引，键值对属性交给<code>object</code></li>
<li>arr[‘1’] 指向arr[1]。</li>
<li>类数组转化:<code>Array.prototype.slice.call()</code>、<code>Array.from(..)</code>、<code>map()</code></li>
</ul>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><ul>
<li><code>string</code>是不可变的，<code>string</code>上没有一个方法是可以原地修改它的内容的，而是创建并返回一个新的<code>string</code></li>
<li>可以借助array的某些方法来处理<code>string</code></li>
<li>翻转一个string：<code>var newString = string.split(&#39;&#39;).reverse().join(&#39;&#39;)</code></li>
</ul>
<h3 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h3><ul>
<li>JS没有真正的整数，在JS中，一个“整数”只是一个没有小数部分的小数值。</li>
<li>‘整数’和’小数’部分如果是0，那就可选。<code>.1 === 0.1</code> <code>1. ===  1.0</code></li>
<li>转化成指数形式： <code>toExponential()</code></li>
<li>指定保留几位小数： <code>toFixed()</code></li>
<li>指定保留几位有效数字： <code>toPrecision()</code></li>
<li><code>42.toFixed( 3 );// SyntaxError</code> 因为<code>42.</code>是合法的number字面量</li>
<li>不应该使用<code>0O363</code>这样的八进制，保持使用小写的谓词0x，0b，和0o。</li>
</ul>
<h4 id="小数值"><a href="#小数值" class="headerlink" title="小数值"></a>小数值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.1</span> + <span class="number">0.2</span> === <span class="number">0.3</span>; <span class="comment">// false 0.1和0.2的二进制表示形式是不精确的</span></span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>es6的极小机械值（容差值）Number.EPSILON， 为2^-52（2.220446049250313e-16），两数只差小于这个值，就可以被认为是相等的</p>
</blockquote>
<p>es6前的填补：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Number</span>.EPSILON) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.EPSILON = <span class="built_in">Math</span>.pow(<span class="number">2</span>，<span class="number">-52</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h4><p>可以被表示的最大的浮点值：<code>Number.MAX_VALUE</code>，极小的一端（不是负值）：<code>Number.MIN_VALUE</code></p>
<p>es6中定义的最大安全整数：<code>Number.MAX_SAFE_INTEGER</code>，最小值：<code>Number.MIN_SAFE_INTEGER</code></p>
<p>测试整数:Number.isInteger(..)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es6前的填补</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Number</span>.isInteger) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.isInteger = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">typeof</span> num == <span class="string">"number"</span> &amp;&amp; num % <span class="number">1</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试一个值是否是安全整数:Number.isSafeInteger(..)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es6前的填补</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Number</span>.isSafeInteger) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.isSafeInteger = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Number</span>.isInteger( num ) &amp;&amp;</span><br><span class="line">            <span class="built_in">Math</span>.abs( num ) &lt;= <span class="built_in">Number</span>.MAX_SAFE_INTEGER;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一些数字操作（比如位操作符）是仅仅为32位number定义的。</p>
<h3 id="特殊值"><a href="#特殊值" class="headerlink" title="特殊值"></a>特殊值</h3><ul>
<li>null: 空值，曾经有过值但现在没有，关键字，不能做标识符</li>
<li>undefined: 还没有值，可以做标识符</li>
<li>void操作符: 不会修改任何已经存在的值；只是确保不会有值从操作符表达式中返回来。所以这个表达式的结果总是值undefined。</li>
</ul>
<h4 id="Infinity"><a href="#Infinity" class="headerlink" title="Infinity"></a>Infinity</h4><ul>
<li>无穷：如果操作的结果太大以至于无法正确表示就会选择用<code>Infinity</code>表示，<code>（+-）Infinity/（+-）Infinity</code>结果为<code>NaN</code></li>
</ul>
<h4 id="NaN（Not-a-Number）"><a href="#NaN（Not-a-Number）" class="headerlink" title="NaN（Not a Number）"></a>NaN（Not a Number）</h4><p>但是类型是number，它从来不等于它自己：NaN !== NaN</p>
<ul>
<li>isNaN(..)：用于测试是否不是一个数字</li>
<li>Number.isNaN(..)：用于测试是否是NaN</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es6前的填补</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Number</span>.isNaN) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.isNaN = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="keyword">typeof</span> n === <span class="string">"number"</span> &amp;&amp;</span><br><span class="line">            <span class="built_in">window</span>.isNaN( n )</span><br><span class="line">        );</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者：</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Number</span>.isNaN) &#123;</span><br><span class="line">    <span class="built_in">Number</span>.isNaN = <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> n !== n;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="零"><a href="#零" class="headerlink" title="零"></a>零</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否是`-0`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNegZero</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    n = <span class="built_in">Number</span>( n );</span><br><span class="line">    <span class="keyword">return</span> (n === <span class="number">0</span>) &amp;&amp; (<span class="number">1</span> / n === -<span class="literal">Infinity</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="绝对等价"><a href="#绝对等价" class="headerlink" title="绝对等价"></a>绝对等价</h4><p>Object.is(..)：测试两个值的绝对等价性,不受NaN和正负零的影响</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es6前的填补</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">Object</span>.is) &#123;</span><br><span class="line">    <span class="built_in">Object</span>.is = <span class="function"><span class="keyword">function</span>(<span class="params">v1, v2</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 测试 `-0`</span></span><br><span class="line">        <span class="keyword">if</span> (v1 === <span class="number">0</span> &amp;&amp; v2 === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> / v1 === <span class="number">1</span> / v2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 测试 `NaN`</span></span><br><span class="line">        <span class="keyword">if</span> (v1 !== v1) &#123;</span><br><span class="line">            <span class="keyword">return</span> v2 !== v2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 其他情况</span></span><br><span class="line">        <span class="keyword">return</span> v1 === v2;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="值与引用"><a href="#值与引用" class="headerlink" title="值与引用"></a>值与引用</h2><p>简单值（也叫基本标量） 总是 通过值拷贝来赋予/传递：null，undefined，string，number， boolean，以及ES6的symbol。</p>
<p>复合值——object（包括array，和所有的对象包装器）和function——总是 在赋值或传递时创建一个引用的拷贝。</p>
<p>引用与其他语言中的引用/指针不同 —— 它们从不指向其他的变量/引用，而仅指向值。</p>
<p>简单值作为函数参数时，传入的是值的拷贝，函数内的操作不会影响外部的值，如果想让函数影响传入的参数，可以将简单值包装成复合值（对象）。</p>
<p>相反的，复合值作为参数传入时，是传入值的引用，函数内对这个引用的操作会影响外部的引用，如果不想让外部的引用受到影响，可以将复合值做一个拷贝后传入，比如参数是<code>array</code>，可以使用<code>slice()</code>处理后传入函数。</p>
<h2 id="原生类型"><a href="#原生类型" class="headerlink" title="原生类型"></a>原生类型</h2><p>最常用的原生类型的一览：</p>
<ul>
<li>String()</li>
<li>Number()</li>
<li>Boolean()</li>
<li>Array()</li>
<li>Object()</li>
<li>Function()</li>
<li>RegExp()</li>
<li>Date()</li>
<li>Error()</li>
<li>Symbol() —— ES6加入</li>
</ul>
<p>这些原生类型实际上是内建函数，其构建的值是一个包含这个值的对象，typeof显示这些对象不是它们自己的特殊类型，而是object类型的子类型。</p>
<p>如果没有必要，避免使用对象包装器，而是直接使用直接字面量，访问字面量属性时JS会自动进行封装。</p>
<h3 id="对象包装器"><a href="#对象包装器" class="headerlink" title="对象包装器"></a>对象包装器</h3><p>Boolean包装的值：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Boolean</span>( <span class="literal">false</span> ); <span class="comment">// object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!a) &#123; <span class="comment">// false</span></span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Oops"</span> ); <span class="comment">// 永远不会运行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>封箱一个基本类型值: <code>Object();</code></p>
<p>开箱，取出底层的基本类型值：<code>valueOf();</code></p>
<h3 id="原生类型作为构造器"><a href="#原生类型作为构造器" class="headerlink" title="原生类型作为构造器"></a>原生类型作为构造器</h3><h4 id="Array-构造器"><a href="#Array-构造器" class="headerlink" title="Array(..)构造器"></a>Array(..)构造器</h4><p>Array(..)构造器不要求在它前面使用new关键字,如果它仅仅被传入一个number参数,那么这个参数就会作为长度，创建一个带有“空值槽”的“稀散数组”。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Array</span>( <span class="number">3</span> );</span><br><span class="line"><span class="keyword">var</span> b = [ <span class="literal">undefined</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span> ];</span><br><span class="line"><span class="keyword">var</span> c = [];</span><br><span class="line">c.length = <span class="number">3</span>;</span><br><span class="line">a; <span class="comment">// [undefined × 3]</span></span><br><span class="line">b; <span class="comment">// [undefined, undefined, undefined]</span></span><br><span class="line">c; <span class="comment">// [undefined × 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个实际的undefined值的数组（不只是“空值槽”）</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="built_in">Array</span>.apply( <span class="literal">null</span>, &#123; <span class="attr">length</span>: <span class="number">3</span> &#125; );</span><br><span class="line">d; <span class="comment">// [ undefined, undefined, undefined ]</span></span><br></pre></td></tr></table></figure>
<h4 id="Object-，Function-和RegExp"><a href="#Object-，Function-和RegExp" class="headerlink" title="Object(..)，Function(..)和RegExp(..)"></a>Object(..)，Function(..)和RegExp(..)</h4><p>需要动态地定义一个函数的参数和/或它的函数体时才使用<code>Function()</code>,需要动态定义一个正则表达式时才使用<code>RegExp(..)</code></p>
<h4 id="Date-和Error"><a href="#Date-和Error" class="headerlink" title="Date(..)和Error(..)"></a>Date(..)和Error(..)</h4><p>Date(..)和Error(..)原生类型构造器要比其他种类的原生类型有用得多，因为它们没有字面量形式。</p>
<p>Date()如果不用<code>new</code>调用，将会返回时间的字符串形式。</p>
<h4 id="Symbol"><a href="#Symbol" class="headerlink" title="Symbol(..)"></a>Symbol(..)</h4><p>ES6新增的基本值类型，主要用途可能是私有属性，或者类似的特殊属性。</p>
<h3 id="原生类型原型"><a href="#原生类型原型" class="headerlink" title="原生类型原型"></a>原生类型原型</h3><p>每一个内建的原生构造器都拥有它自己的.prototype对象，该构造器构建的实例可以访问构造器原型对象上的属性/方法。</p>
<p>一些原生类型的原型不 仅仅 是单纯的对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ypeof <span class="built_in">Function</span>.prototype;            <span class="comment">// "function"</span></span><br><span class="line"><span class="built_in">Function</span>.prototype();                <span class="comment">// 它是一个空函数！</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">RegExp</span>.prototype.toString();        <span class="comment">// "/(?:)/" —— 空的正则表达式</span></span><br><span class="line"><span class="string">"abc"</span>.match( <span class="built_in">RegExp</span>.prototype );    <span class="comment">// [""]</span></span><br></pre></td></tr></table></figure></p>
<p>构造器原型对象详见<code>原型对象和原型链</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/04/16/CSS点滴：页面加载动画/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/16/CSS点滴：页面加载动画/" itemprop="url">CSS花园：页面加载动画</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-16T20:11:22+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CSS/" itemprop="url" rel="index">
                    <span itemprop="name">CSS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>页面切换需要加载时间，这个过程对于用户而言是无聊的，如果时间过长，很可能引起用户的不快，甚至关掉页面。如果在页面加载期间，展现有趣的动画，可以转移用户的注意力，提高用户体验。下面展示了几种有趣的加载小动画，为了便于展示，引入了jsFiddle。因为jsFiddle有时候会抽风，顺便也把代码贴一下, 以后有需要方便复制粘贴~~~</p>
<h5 id="加载动画1："><a href="#加载动画1：" class="headerlink" title="加载动画1："></a>加载动画1：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/d2wer0xj/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spinner"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.spinner</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-rotateplane <span class="number">1.2s</span> infinite ease-in-out;</span><br><span class="line">  <span class="attribute">animation</span>: sk-rotateplane <span class="number">1.2s</span> infinite ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-rotateplane &#123;</span><br><span class="line">  0% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) &#125;</span><br><span class="line">  50% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateY</span>(180deg) &#125;</span><br><span class="line">  100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateY</span>(180deg)  <span class="built_in">rotateX</span>(180deg) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-rotateplane &#123;</span><br><span class="line">  0% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(0deg) <span class="built_in">rotateY</span>(0deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(0deg) <span class="built_in">rotateY</span>(0deg) </span><br><span class="line">  &#125; 50% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(-180.1deg) <span class="built_in">rotateY</span>(0deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(-180.1deg) <span class="built_in">rotateY</span>(0deg) </span><br><span class="line">  &#125; 100% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(-180deg) <span class="built_in">rotateY</span>(-179.9deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(120px) <span class="built_in">rotateX</span>(-180deg) <span class="built_in">rotateY</span>(-179.9deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画2："><a href="#加载动画2：" class="headerlink" title="加载动画2："></a>加载动画2：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/qkmy3q3f/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spinner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"double-bounce1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"double-bounce2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.spinner</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.double-bounce1</span>, <span class="selector-class">.double-bounce2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-bounce <span class="number">2.0s</span> infinite ease-in-out;</span><br><span class="line">  <span class="attribute">animation</span>: sk-bounce <span class="number">2.0s</span> infinite ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.double-bounce2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">1.0s</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: -<span class="number">1.0s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-bounce &#123;</span><br><span class="line">  0%, 100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0.0) &#125;</span><br><span class="line">  50% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-bounce &#123;</span><br><span class="line">  0%, 100% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(0.0);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0.0);</span><br><span class="line">  &#125; 50% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画3："><a href="#加载动画3：" class="headerlink" title="加载动画3："></a>加载动画3：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/o599kbz7/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spinner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cube1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cube2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.spinner</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cube1</span>, <span class="selector-class">.cube2</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#00B8A9</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-cubemove <span class="number">1.8s</span> infinite ease-in-out;</span><br><span class="line">  <span class="attribute">animation</span>: sk-cubemove <span class="number">1.8s</span> infinite ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cube2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.9s</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: -<span class="number">0.9s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-cubemove &#123;</span><br><span class="line">  25% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">rotate</span>(-90deg) <span class="built_in">scale</span>(0.5) &#125;</span><br><span class="line">  50% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-180deg) &#125;</span><br><span class="line">  75% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(0px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-270deg) <span class="built_in">scale</span>(0.5) &#125;</span><br><span class="line">  100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(-360deg) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-cubemove &#123;</span><br><span class="line">  25% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">rotate</span>(-90deg) <span class="built_in">scale</span>(0.5);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">rotate</span>(-90deg) <span class="built_in">scale</span>(0.5);</span><br><span class="line">  &#125; 50% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-179deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-179deg);</span><br><span class="line">  &#125; 50<span class="selector-class">.1</span>% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-180deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(42px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-180deg);</span><br><span class="line">  &#125; 75% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(0px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-270deg) <span class="built_in">scale</span>(0.5);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">translateX</span>(0px) <span class="built_in">translateY</span>(42px) <span class="built_in">rotate</span>(-270deg) <span class="built_in">scale</span>(0.5);</span><br><span class="line">  &#125; 100% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-360deg);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(-360deg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画4："><a href="#加载动画4：" class="headerlink" title="加载动画4："></a>加载动画4：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/danat002/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spinner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dot1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dot2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.spinner</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-rotate <span class="number">2.0s</span> infinite linear;</span><br><span class="line">  <span class="attribute">animation</span>: sk-rotate <span class="number">2.0s</span> infinite linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dot1</span>, <span class="selector-class">.dot2</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60%</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#F38181</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-bounce <span class="number">2.0s</span> infinite ease-in-out;</span><br><span class="line">  <span class="attribute">animation</span>: sk-bounce <span class="number">2.0s</span> infinite ease-in-out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.dot2</span> &#123;</span><br><span class="line">  <span class="attribute">top</span>: auto;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">1.0s</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: -<span class="number">1.0s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-rotate &#123; 100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(360deg) &#125;&#125;</span><br><span class="line">@<span class="keyword">keyframes</span> sk-rotate &#123; 100% &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(360deg); <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(360deg) &#125;&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-bounce &#123;</span><br><span class="line">  0%, 100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0.0) &#125;</span><br><span class="line">  50% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-bounce &#123;</span><br><span class="line">  0%, 100% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(0.0);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0.0);</span><br><span class="line">  &#125; 50% &#123; </span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画5："><a href="#加载动画5：" class="headerlink" title="加载动画5："></a>加载动画5：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/vz7ec4v8/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spinner"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bounce1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bounce2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"bounce3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.spinner</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.spinner</span> &gt; <span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">18px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#46CDCF</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-bouncedelay <span class="number">1.4s</span> infinite ease-in-out both;</span><br><span class="line">  <span class="attribute">animation</span>: sk-bouncedelay <span class="number">1.4s</span> infinite ease-in-out both;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.spinner</span> <span class="selector-class">.bounce1</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.32s</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: -<span class="number">0.32s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.spinner</span> <span class="selector-class">.bounce2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.16s</span>;</span><br><span class="line">  <span class="attribute">animation-delay</span>: -<span class="number">0.16s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-bouncedelay &#123;</span><br><span class="line">  0%, 80%, 100% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0) &#125;</span><br><span class="line">  40% &#123; <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-bouncedelay &#123;</span><br><span class="line">  0%, 80%, 100% &#123; </span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">  &#125; 40% &#123; </span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.0);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画6："><a href="#加载动画6：" class="headerlink" title="加载动画6："></a>加载动画6：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/r8rer0L7/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle1 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle2 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle3 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle4 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle5 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle6 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle7 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle8 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle9 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle10 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle11 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-circle12 sk-child"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sk-circle</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-child</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-child</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">15%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">15%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#00ADB5</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-circleBounceDelay <span class="number">1.2s</span> infinite ease-in-out both;</span><br><span class="line">          <span class="attribute">animation</span>: sk-circleBounceDelay <span class="number">1.2s</span> infinite ease-in-out both;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(30deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(30deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(30deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle3</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(60deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(60deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(60deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle4</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(90deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(90deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(90deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle5</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(120deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(120deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(120deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle6</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(150deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(150deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(150deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle7</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(180deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(180deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(180deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle8</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(210deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(210deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(210deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle9</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(240deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(240deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(240deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle10</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(270deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(270deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(270deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle11</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(300deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(300deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(300deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle12</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(330deg);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(330deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotate</span>(330deg); &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle2</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">1.1s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">1.1s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle3</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">1s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">1s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle4</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.9s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.9s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle5</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.8s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.8s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle6</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.7s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.7s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle7</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.6s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.6s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle8</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.5s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.5s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle9</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.4s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.4s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle10</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.3s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.3s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle11</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.2s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.2s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-circle</span> <span class="selector-class">.sk-circle12</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: -<span class="number">0.1s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: -<span class="number">0.1s</span>; &#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-circleBounceDelay &#123;</span><br><span class="line">  0%, 80%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">  &#125; 40% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale</span>(1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-circleBounceDelay &#123;</span><br><span class="line">  0%, 80%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale</span>(0);</span><br><span class="line">  &#125; 40% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale</span>(1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画7："><a href="#加载动画7：" class="headerlink" title="加载动画7："></a>加载动画7：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/L7nvohot/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube-grid"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube4"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube5"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube6"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube7"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube8"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube sk-cube9"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sk-cube-grid</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">33%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">33%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#F38181</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-cubeGridScaleDelay <span class="number">1.3s</span> infinite ease-in-out;</span><br><span class="line">          <span class="attribute">animation</span>: sk-cubeGridScaleDelay <span class="number">1.3s</span> infinite ease-in-out; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube1</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.2s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.2s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.3s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.3s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube3</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.4s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.4s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube4</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.1s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.1s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube5</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.2s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.2s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube6</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.3s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.3s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube7</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube8</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.1s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.1s</span>; &#125;</span><br><span class="line"><span class="selector-class">.sk-cube-grid</span> <span class="selector-class">.sk-cube9</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.2s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.2s</span>; &#125;</span><br><span class="line"></span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-cubeGridScaleDelay &#123;</span><br><span class="line">  0%, 70%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale3D</span>(1, 1, 1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale3D</span>(1, 1, 1);</span><br><span class="line">  &#125; 35% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale3D</span>(0, 0, 1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale3D</span>(0, 0, 1); </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-cubeGridScaleDelay &#123;</span><br><span class="line">  0%, 70%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale3D</span>(1, 1, 1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale3D</span>(1, 1, 1);</span><br><span class="line">  &#125; 35% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">scale3D</span>(0, 0, 1);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">scale3D</span>(0, 0, 1);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画8："><a href="#加载动画8：" class="headerlink" title="加载动画8："></a>加载动画8：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/njs6v6k5/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-folding-cube"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube1 sk-cube"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube2 sk-cube"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube4 sk-cube"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sk-cube3 sk-cube"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sk-folding-cube</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">100px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">rotateZ</span>(45deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(45deg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.1);</span><br><span class="line">      <span class="attribute">-ms-transform</span>: <span class="built_in">scale</span>(1.1);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.1); </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3FBAC2</span>;</span><br><span class="line">  <span class="attribute">-webkit-animation</span>: sk-foldCubeAngle <span class="number">2.4s</span> infinite linear both;</span><br><span class="line">          <span class="attribute">animation</span>: sk-foldCubeAngle <span class="number">2.4s</span> infinite linear both;</span><br><span class="line">  <span class="attribute">-webkit-transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">      <span class="attribute">-ms-transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">          <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube2</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(90deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(90deg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube3</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(180deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(180deg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube4</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(270deg);</span><br><span class="line">          <span class="attribute">transform</span>: <span class="built_in">scale</span>(1.1) <span class="built_in">rotateZ</span>(270deg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube2</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.3s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube3</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.6s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.6s</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sk-folding-cube</span> <span class="selector-class">.sk-cube4</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-animation-delay</span>: <span class="number">0.9s</span>;</span><br><span class="line">          <span class="attribute">animation-delay</span>: <span class="number">0.9s</span>;</span><br><span class="line">&#125;</span><br><span class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> sk-foldCubeAngle &#123;</span><br><span class="line">  0%, 10% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(-180deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(-180deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>; </span><br><span class="line">  &#125; 25%, 75% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(0deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(0deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>; </span><br><span class="line">  &#125; 90%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateY</span>(180deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateY</span>(180deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>; </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">keyframes</span> sk-foldCubeAngle &#123;</span><br><span class="line">  0%, 10% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(-180deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(-180deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>; </span><br><span class="line">  &#125; 25%, 75% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(0deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateX</span>(0deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>; </span><br><span class="line">  &#125; 90%, 100% &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateY</span>(180deg);</span><br><span class="line">            <span class="attribute">transform</span>: <span class="built_in">perspective</span>(140px) <span class="built_in">rotateY</span>(180deg);</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="加载动画9："><a href="#加载动画9：" class="headerlink" title="加载动画9："></a>加载动画9：</h5><iframe scrolling="no" width="100%" height="300" src="//jsfiddle.net/s16eg1aq/embedded/result,html,css/light" frameborder="0" allowfullscreen></iframe>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"load-3"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-4"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-5"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-6"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-7"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"k-line2 k-line12-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.k-line2</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>:inline-block;</span><br><span class="line">        <span class="attribute">background</span>:<span class="number">#14FFEC</span>;</span><br><span class="line">        <span class="attribute">height</span>:<span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">opacity</span>:<span class="number">0</span>;</span><br><span class="line">        <span class="attribute">border-radius</span>:<span class="number">50%</span>;</span><br><span class="line">        <span class="attribute">transform</span>:<span class="built_in">translateX</span>(-800px);</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="number">#08D9D6</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-1</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">8s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-2</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">7s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-3</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">6s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-4</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">5s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-5</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">4s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-6</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">3s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-7</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">2s</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.k-line12-8</span> &#123;</span><br><span class="line">        <span class="attribute">animation</span>:k-loadingS <span class="number">4s</span> infinite;</span><br><span class="line">        <span class="attribute">animation-delay</span>:.<span class="number">1s</span></span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">keyframes</span> k-loadingS &#123;</span><br><span class="line">        40% &#123;</span><br><span class="line">            <span class="attribute">transform</span>:<span class="built_in">translateX</span>(0);</span><br><span class="line">            <span class="attribute">opacity</span>:.<span class="number">8</span></span><br><span class="line">        &#125;</span><br><span class="line">        100% &#123;</span><br><span class="line">            <span class="attribute">transform</span>:<span class="built_in">translateX</span>(300px);</span><br><span class="line">            <span class="attribute">opacity</span>:<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ifun.work/2017/04/15/You-don-t-know-JS-this和对象原型-笔记（四）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="weihome">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="乌斯怀亚-世界以南">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/15/You-don-t-know-JS-this和对象原型-笔记（四）/" itemprop="url">You don't know JS:this和对象原型 笔记（四）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-15T18:22:26+08:00">
                2017-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JS/" itemprop="url" rel="index">
                    <span itemprop="name">JS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="原型和行为委托"><a href="#原型和行为委托" class="headerlink" title="原型和行为委托"></a>原型和行为委托</h1><h2 id="JS模拟类的继承"><a href="#JS模拟类的继承" class="headerlink" title="JS模拟类的继承"></a>JS模拟类的继承</h2><p>类是面向对象语言的一种设计模式，当一个传统的类被实例化时，就发生了类的行为向实例中拷贝。当类被继承时，也发生父类的行为向子类的拷贝。</p>
<p>在JS中，不会自动地（像类那样）在对象间创建拷贝。为了模拟类的继承，出现了明确的Mixins和隐含的Mixins</p>
<h3 id="明确的-Mixins"><a href="#明确的-Mixins" class="headerlink" title="明确的 Mixins"></a>明确的 Mixins</h3><p>显式mixin不同于类的拷贝，因为对象（和函数）仅仅是共享的<strong>引用</strong>被复制，不是对象/函数自身被复制。这种引用会影响到所有指向它的对象的属性。</p>
<h3 id="隐含的-Mixin"><a href="#隐含的-Mixin" class="headerlink" title="隐含的 Mixin"></a>隐含的 Mixin</h3><p>其实就是利用<code>this</code>的绑定规则，改变了执行环境。</p>
<h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><p>某种程度是显式的又是隐含的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// “传统的JS类” `Vehicle`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vehicle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.engines = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">Vehicle.prototype.ignition = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Turning on my engine."</span> );</span><br><span class="line">&#125;;</span><br><span class="line">Vehicle.prototype.drive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ignition();</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="string">"Steering and moving forward!"</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// “寄生类” `Car`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 首先, `car`是一个`Vehicle`</span></span><br><span class="line">    <span class="keyword">var</span> car = <span class="keyword">new</span> Vehicle();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 现在, 我们修改`car`使它特化</span></span><br><span class="line">    car.wheels = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存一个`Vehicle:drive()`的引用</span></span><br><span class="line">    <span class="keyword">var</span> vehDrive = car.drive;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 覆盖 `Vehicle:drive()`</span></span><br><span class="line">    car.drive = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        vehDrive.call( <span class="keyword">this</span> );</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">"Rolling on all "</span> + <span class="keyword">this</span>.wheels + <span class="string">" wheels!"</span> );</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> car;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用new调用默认返回创建的新对象，但是这里返回car对象，所以也可以不使用new调用</span></span><br><span class="line"><span class="keyword">var</span> myCar = <span class="keyword">new</span> Car();</span><br><span class="line"></span><br><span class="line">myCar.drive();</span><br><span class="line"><span class="comment">// Turning on my engine.</span></span><br><span class="line"><span class="comment">// Steering and moving forward!</span></span><br><span class="line"><span class="comment">// Rolling on all 4 wheels!</span></span><br></pre></td></tr></table></figure></p>
<h2 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h2><p>JavaScript中的对象有一个内部属性，在语言规范中称为[[Prototype]]，它只是一个其他对象的引用。几乎所有的对象在被创建时，它的这个属性都被赋予了一个非null值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> anotherObject = &#123;</span><br><span class="line">    a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个链接到`anotherObject`的对象</span></span><br><span class="line"><span class="keyword">var</span> myObject = <span class="built_in">Object</span>.create( anotherObject );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果默认的[[Get]]操作不能直接在对象上找到被请求的属性，那么会沿着对象的[[Prototype]]链继续处理</span></span><br><span class="line">myObject.a; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>但是，如果在anotherObject上也没有找到a，而且如果它的[[Prototype]]链不为空，就沿着它继续查找。</p>
<p>这个处理持续进行，直到找到名称匹配的属性，或者[[Prototype]]链终结。如果在链条的末尾都没有找到匹配的属性，那么[[Get]]操作的返回结果为undefined。</p>
<p><code>for..in</code> 和操作符 <code>in</code> 对属性的查询也是如此，这俩个区别在于属性是否可枚举。</p>
<p>每个普通的[[Prototype]]链的最顶端，是内建的Object.prototype。这个对象包含各种在整个JS中被使用的共通工具，因为JavaScript中所有普通（内建，而非被宿主环境扩展的）的对象都“衍生自”（也就是，它们的[[Prototype]]顶端为）Object.prototype对象。</p>
<h3 id="设置与遮蔽属性"><a href="#设置与遮蔽属性" class="headerlink" title="设置与遮蔽属性"></a>设置与遮蔽属性</h3><p>需要设置一个属性如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myObject.foo = <span class="string">"bar"</span>;</span><br></pre></td></tr></table></figure>
<p>如果myObject对象已拥有了这个属性，那么就直接赋值。</p>
<p>如果foo还没有直接存在于myObject，[[Prototype]]就会被遍历，如果在链条的任何地方都没有找到foo，属性foo就以指定的值被直接添加到myObject上。</p>
<p>属性遮蔽是指如果在原型链上存在同名的属性，低处的属性先于高处的属性被找到，就返回最先被找到的属性，形成对更高处同名属性的遮蔽。</p>
<p>如果foo属性存在于原型链的更高处，就会根据情况处理：</p>
<ol>
<li>如果没有被标记为只读，那么一个名为foo的新属性就直接添加到myObject上，形成一个遮蔽属性。</li>
<li>如果被标记为只读，那么设置既存属性和在myObject上创建遮蔽属性都是不允许的。如果代码运行在strict mode下，一个错误会被抛出。否则，这个设置属性值的操作会被无声地忽略。不论怎样，没有发生遮蔽。这个限制仅限于=赋值，当使用Object.defineProperty(..)时不被强制。</li>
<li>如果它是一个setter，那么这个setter总是被调用。没有foo会被添加到（也就是遮蔽在）myObject上，这个foosetter也不会被重定义。</li>
</ol>
<h3 id="JS中的new调用"><a href="#JS中的new调用" class="headerlink" title="JS中的new调用"></a>JS中的new调用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( a ) === Foo.prototype; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>在面向类的语言中，类可以有多个实例，将类的属性和方法拷贝到新实例中。</p>
<p>但是在JavaScript中，不会创建类的多个实例，而是创建多个对象，它们的[[Prototype]]连接至一个共通对象。但默认地，没有拷贝发生，这些对象彼此间链接在一起。</p>
<p>new Foo()得到一个新对象（我们叫他a），这个新对象a内部地被[[Prototype]]链接至Foo.prototype对象。当然也没有从一个“类”到一个实体对象的拷贝，只是让两个对象互相链接在一起。</p>
<p>new Foo()是一个间接的，迂回的方法来得到我们想要的：一个被链接到另一个对象的对象。</p>
<h3 id="JS中的“构造器”还是“构造器调用”？"><a href="#JS中的“构造器”还是“构造器调用”？" class="headerlink" title="JS中的“构造器”还是“构造器调用”？"></a>JS中的“构造器”还是“构造器调用”？</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.constructor === Foo; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Foo();</span><br><span class="line">a.constructor === Foo; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>上面的代码的段中，我们试图认为Foo是一个“构造器”，是因为我们用new调用它，而且我们观察到它“构建”了一个对象。</p>
<p>然而Foo函数自身不是构造器。不过，当你在普通函数调用前面放一个new关键字时，这就将函数调用变成了“构造器调用”。事实上，new在某种意义上将它以另一种方式调用：构建一个对象，外加这个函数要做的其他任何事。</p>
<p><code>a.constructor === Foo;</code>似乎意味着a是被Foo构建的，意味着a拥有一个.constructor属性，指向Foo？实际上，<code>.constructor</code>引用也委托到了Foo.prototype，而它指向Foo。</p>
<p>在Foo.prototype上的<code>.constructor</code>属性仅当Foo函数被声明时才出现在对象上。如果你创建一个新对象，并用它替换函数默认的.prototype对象引用，被new调用返回的新对象并不会得到<code>.constructor</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125; <span class="comment">// 函数声明时，函数的prototype对象得到一个`.constructor`属性，指向Foo</span></span><br><span class="line">Foo.prototype.constructor === Foo; <span class="comment">// true</span></span><br><span class="line">Foo.prototype = &#123; <span class="comment">/* .. */</span> &#125;; <span class="comment">// 创建一个新的prototype对象替换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a1 = <span class="keyword">new</span> Foo();</span><br><span class="line">a1.constructor === Foo; <span class="comment">// false</span></span><br><span class="line">a1.constructor === <span class="built_in">Object</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>如果Foo构建了a1，那么<code>a1.constructor</code>应该等于Foo。实际上，a1没有.constructor属性，所以它沿者[[Prototype]]链向上委托到了Foo.prototype。但是这个对象也没有.constructor（默认的Foo.prototype对象有，但是这里被替换掉了），所以它继续委托，这次轮到了Object.prototype，委托链的最顶端。那个对象上确实拥有.constructor，它指向内建的Object(..)函数。</p>
<p>当然，可以把.constructor加回到Foo.prototype对象上：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123; <span class="comment">/* .. */</span> &#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype = &#123; <span class="comment">/* .. */</span> &#125;; <span class="comment">// 创建一个新的prototype对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要正确地“修复”丢失的`.construcor`</span></span><br><span class="line"><span class="comment">// 新对象上的属性以`Foo.prototype`的形式提供。</span></span><br><span class="line"><span class="comment">// `defineProperty(..)`的内容见第三章。</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty( Foo.prototype, <span class="string">"constructor"</span> , &#123;</span><br><span class="line">    enumerable: <span class="literal">false</span>,</span><br><span class="line">    writable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    value: Foo    <span class="comment">// 使`.constructor`指向`Foo`</span></span><br><span class="line">&#125; );</span><br></pre></td></tr></table></figure></p>
<p>所以，<code>.constructor</code>不是一个不可变的属性。它是不可枚举的，但是它的值是可写的（可以改变），而且，你可以在[[Prototype]]链上的任何对象上添加或覆盖（有意或无意地）名为constructor的属性, 看到它的实际意义有多随便了吗？</p>
<h3 id="如何创建链接"><a href="#如何创建链接" class="headerlink" title="如何创建链接"></a>如何创建链接</h3><h4 id="典型的原型风格"><a href="#典型的原型风格" class="headerlink" title="典型的原型风格"></a>典型的原型风格</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.myName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">name,label</span>) </span>&#123;</span><br><span class="line">    Foo.call( <span class="keyword">this</span>, name );</span><br><span class="line">    <span class="keyword">this</span>.label = label;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里，我们创建一个新的`Bar.prototype`链接链到`Foo.prototype`</span></span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create( Foo.prototype );</span><br><span class="line"></span><br><span class="line"><span class="comment">// es6新增，修改既存的`Bar.prototype`</span></span><br><span class="line"><span class="comment">// Object.setPrototypeOf( Bar.prototype, Foo.prototype );</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意！现在`Bar.prototype.constructor`不存在了，</span></span><br><span class="line"><span class="comment">// 如果你有依赖这个属性的习惯的话，可以被手动“修复”。</span></span><br><span class="line"></span><br><span class="line">Bar.prototype.myLabel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.label;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Bar( <span class="string">"a"</span>, <span class="string">"obj a"</span> );</span><br><span class="line"></span><br><span class="line">a.myName(); <span class="comment">// "a"</span></span><br><span class="line">a.myLabel(); <span class="comment">// "obj a"</span></span><br></pre></td></tr></table></figure>
<p>另外两种不那么好用的做法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不会如你期望的那样工作!</span></span><br><span class="line">Bar.prototype = Foo.prototype;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 会如你期望的那样工作</span></span><br><span class="line"><span class="comment">// 但会带有你可能不想要的副作用 :(</span></span><br><span class="line">Bar.prototype = <span class="keyword">new</span> Foo();</span><br></pre></td></tr></table></figure></p>
<p><code>Bar.prototype = Foo.prototype</code>不会创建新对象让<code>Bar.prototype</code>链接,它只是让<code>Bar.prototype</code>成为<code>Foo.prototype</code>的另一个引用，这意味着赋值时，比如Bar.prototype.myLabel = …，修改的是那个被分享的Foo.prototype对象本身，它将影响到所有链接到Foo.prototype的对象。</p>
<p><code>Bar.prototype = new Foo()</code>确实创建了一个新的对象，这个新对象也的确链接到了我们希望的Foo.prototype。但是，它是用Foo(..)“构造器调用”来这样做的。如果这个函数有任何副作用（比如logging，改变状态，注册其他对象，向this添加数据属性，等等），这些副作用就会在链接时发生（而且很可能是对错误的对象！），而不是像希望的那样，仅最终在Bar()的“后裔”被创建时发生。</p>
<h4 id="Object-create"><a href="#Object-create" class="headerlink" title="Object.create(..)"></a>Object.create(..)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    something: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">"Tell me something good..."</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = <span class="built_in">Object</span>.create( foo );</span><br><span class="line"></span><br><span class="line">bar.something(); <span class="comment">// Tell me something good...</span></span><br></pre></td></tr></table></figure>
<p>Object.create(..)创建了一个链接到我们指定的对象（foo）上的新对象（bar），而且没有new函数作为类和构造器调用产生的任何没必要的复杂性，搞乱<code>.prototype</code>和<code>.constructor</code>引用，或任何其他的多余的东西。</p>
<p>Object.create(..)在ES5中被加入。如果需要支持ES5之前的环境（比如老版本的IE），可以对Object.create(..)进行简单部分填补：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Object</span>.create) &#123;</span><br><span class="line">    <span class="built_in">Object</span>.create = <span class="function"><span class="keyword">function</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">        F.prototype = o;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这种填补是部分的，Object.create(..)还可以接收第二个参数，通过声明每个新属性的<strong>属性描述符</strong>来指定要添加在新对象上的属性名，这个功能无法填补，因为es5以前并没有<strong>属性描述符</strong>。</p>
<h3 id="原型部分总结"><a href="#原型部分总结" class="headerlink" title="原型部分总结"></a>原型部分总结</h3><p><strong>原型链</strong>：当试图在一个对象上进行属性访问，而对象没有该属性时，对象内部的[[Prototype]]链接定义了[[Get]]操作下一步应当到哪里寻找它。这种对象到对象的串行链接定义了对象的“原形链”（和嵌套的作用域链有些相似），在解析属性时发挥作用。</p>
<p><strong>原型链顶端</strong>：所有普通的对象用内建的Object.prototype作为原形链的顶端（就像作用域查询的顶端是全局作用域），如果属性没能在链条的前面任何地方找到，属性解析就会在这里停止。toString()，valueOf()，和其他几种共同工具都存在于这个Object.prototype对象上，这解释了语言中所有的对象是如何能够访问他们的。</p>
<p><strong>new调用</strong>：会建立一个新对象链接到另一个对象，用new调用的函数有一个被命名为<code>.prototype</code>的属性，这个属性所引用的对象恰好就是这个新对象链接到的“另一个对象”。所以，新对象进行属性访问时，如果找不到该属性，就会沿着这个原型链向上查找。</p>
<p><strong>委托</strong>：相比于<em>继承</em>，“委托”是一个更确切的术语，因为这些关系不是<em>拷贝</em>而是<strong>委托</strong>链接。属性访问时，可以委托原型链进行查找。</p>
<h2 id="行为委托"><a href="#行为委托" class="headerlink" title="行为委托"></a>行为委托</h2><h3 id="委托的一个简单实现"><a href="#委托的一个简单实现" class="headerlink" title="委托的一个简单实现"></a>委托的一个简单实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Task = &#123;</span><br><span class="line">    setID: <span class="function"><span class="keyword">function</span>(<span class="params">ID</span>) </span>&#123; <span class="keyword">this</span>.id = ID; &#125;,</span><br><span class="line">    outputID: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log( <span class="keyword">this</span>.id ); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使`XYZ`委托到`Task`</span></span><br><span class="line"><span class="keyword">var</span> XYZ = <span class="built_in">Object</span>.create( Task );</span><br><span class="line"></span><br><span class="line">XYZ.prepareTask = <span class="function"><span class="keyword">function</span>(<span class="params">ID,Label</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setID( ID );</span><br><span class="line">    <span class="keyword">this</span>.label = Label;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">XYZ.outputTaskDetails = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.outputID();</span><br><span class="line">    <span class="built_in">console</span>.log( <span class="keyword">this</span>.label );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在这段代码中，Task和XYZ不是类（也不是函数），它们 仅仅是对象。XYZ通过Object.create()创建，来[[Prototype]]委托到Task对象。</p>
<h3 id="行为委托和类继承的不同"><a href="#行为委托和类继承的不同" class="headerlink" title="行为委托和类继承的不同"></a>行为委托和类继承的不同</h3><p>在类的设计模式中，一般会故意在父类（Task）和子类（XYZ）上采用相同的命名，以至于我们可以利用多态。在委托的行为中，我们反其道而行之：我们尽一切可能避免在[[Prototype]]链的不同层级上给出相同的命名（避免“遮蔽”），因为这些命名冲突会导致尴尬/脆弱的语法来消除引用的歧义。</p>
<p><code>this.setID(ID);</code>位于对象XYZ的一个方法内部，它首先在XYZ上查找<code>setID(..)</code>，但因为它不能在XYZ上找到叫这个名称的方法，[[Prototype]]委托意味着它可以沿着链接到Task来寻找<code>setID()</code>，这样当然就找到了。另外，由于调用点的隐含this绑定规则，当<code>setID()</code>运行时，即便方法是在Task上找到的，这个函数调用的this绑定依然是我们期望和想要的XYZ。换句话说，我们可以使用存在于Task上的泛化工具与XYZ互动，因为XYZ可以委托至Task。</p>
<p><strong>行为委托</strong> 意味着：在某个对象（XYZ）的属性或方法没能在这个对象（XYZ）上找到时，让这个对象（XYZ）为属性或方法引用沿着原型链委托（这里委托到了Task）。相互委托是不允许的，因为可能得到一个无限递归的循环（任意一方都不存在的属性/方法引用）。</p>
<h3 id="思维模型上的比较"><a href="#思维模型上的比较" class="headerlink" title="思维模型上的比较"></a>思维模型上的比较</h3><p>经典的（“原型的”）面向类的风格：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.me = who;</span><br><span class="line">&#125;</span><br><span class="line">Foo.prototype.identify = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"I am "</span> + <span class="keyword">this</span>.me;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">    Foo.call( <span class="keyword">this</span>, who );</span><br><span class="line">&#125;</span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create( Foo.prototype );</span><br><span class="line"></span><br><span class="line">Bar.prototype.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert( <span class="string">"Hello, "</span> + <span class="keyword">this</span>.identify() + <span class="string">"."</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="keyword">new</span> Bar( <span class="string">"b1"</span> );</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="keyword">new</span> Bar( <span class="string">"b2"</span> );</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>
<p>父类Foo，被子类Bar继承，之后Bar被初始化两次：b1和b2。我们得到的是b1委托至Bar.prototype，Bar.prototype委托至Foo.prototype。</p>
<p>面向委托（OLOO ）的风格：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.me = who;</span><br><span class="line">    &#125;,</span><br><span class="line">    identify: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"I am "</span> + <span class="keyword">this</span>.me;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="built_in">Object</span>.create( Foo );</span><br><span class="line"></span><br><span class="line">Bar.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert( <span class="string">"Hello, "</span> + <span class="keyword">this</span>.identify() + <span class="string">"."</span> );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="built_in">Object</span>.create( Bar );</span><br><span class="line">b1.init( <span class="string">"b1"</span> );</span><br><span class="line"><span class="keyword">var</span> b2 = <span class="built_in">Object</span>.create( Bar );</span><br><span class="line">b2.init( <span class="string">"b2"</span> );</span><br><span class="line"></span><br><span class="line">b1.speak();</span><br><span class="line">b2.speak();</span><br></pre></td></tr></table></figure>
<p>现在仅仅建立了相互链接的对象，而不需要所有其他讨厌且困惑的看起来像类（但动起来不像）的东西，还有构造器，原型和new调用。</p>
<p>再来看一下它们的思维模型,首先是类风格：</p>
<p><img src="http://oohz6uxcv.bkt.clouddn.com/oo1.png" alt=""></p>
<p>如果去掉一些技术上不需要（但是需要理解）的细节：</p>
<p><img src="http://oohz6uxcv.bkt.clouddn.com/oo2png.png" alt=""></p>
<p>然后是OLOO风格代码的思维模型：</p>
<p><img src="http://oohz6uxcv.bkt.clouddn.com/oolo.png" alt=""></p>
<p>正如你所比较它们得到的，十分明显，OLOO风格的代码 需要关心的东西少太多了，因为OLOO风格代码接受了事实：我们唯一需要真正关心的事情是 链接到其他对象的对象。</p>
<h3 id="简约方法声明"><a href="#简约方法声明" class="headerlink" title="简约方法声明"></a>简约方法声明</h3><p>在ES6中，我们可以在任何字面对象中使用 简约方法声明，所以一个OLOO风格的对象可以用这种方式声明（与class语法中相同的语法糖）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> LoginController = &#123;</span><br><span class="line">    errors: [],</span><br><span class="line">    getUser() &#123; <span class="comment">// 看，没有`function`！</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getPassword() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>简约方法确实有一个缺点,有代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    bar() &#123; <span class="comment">/*..*/</span> &#125;,</span><br><span class="line">    baz: <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这是去掉语法糖后，这段代码将如何工作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;,</span><br><span class="line">    baz: <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>) </span>&#123; <span class="comment">/*..*/</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>bar()的速记法变成了一个附着在bar属性上的 匿名函数表达式（function()..），因为函数对象本身没有名称标识符。当你陷入缺少自引用的问题时，仅仅为这个声明放弃简明方法语法，取代以手动的命名函数表达式声明形式：baz: function baz(){..}。</p>
<h3 id="类型自省"><a href="#类型自省" class="headerlink" title="类型自省"></a>类型自省</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Foo = &#123; <span class="comment">/* .. */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Bar = <span class="built_in">Object</span>.create( Foo );</span><br><span class="line">Bar...</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 = <span class="built_in">Object</span>.create( Bar );</span><br></pre></td></tr></table></figure>
<p>使用这种OLOO方式，我们所拥有的一切都是通过[[Prototype]]委托关联起来的普通对象，这是我们可能会用到的类型自省：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `Foo`和`Bar`互相的联系</span></span><br><span class="line">Foo.isPrototypeOf( Bar ); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( Bar ) === Foo; <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// `b1`与`Foo`和`Bar`的联系</span></span><br><span class="line">Foo.isPrototypeOf( b1 ); <span class="comment">// true</span></span><br><span class="line">Bar.isPrototypeOf( b1 ); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf( b1 ) === Bar; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>我们不再使用instanceof，因为它令人迷惑地假装与类有关系。现在，我们只需要（非正式地）问这个问题，“你是我的一个原型吗？”。不再需要用Foo.prototype或者痛苦冗长的Foo.prototype.isPrototypeOf(..)来间接地查询了。</p>
<h3 id="行为委托总结"><a href="#行为委托总结" class="headerlink" title="行为委托总结"></a>行为委托总结</h3><p>行为委托意味着对象彼此是对等的，在它们自己当中相互委托，而不是父类与子类的关系。JavaScript的[[Prototype]]机制的设计本质，就是行为委托机制。这意味着我们可以选择挣扎着在JS上实现类机制，也可以欣然接受[[Prototype]]作为委托机制的本性。</p>
<p>当你仅用对象设计代码时，它不仅能简化你使用的语法，而且它还能实际上引领更简单的代码结构设计。</p>
<p>OLOO（链接到其他对象的对像）是一种没有类的抽象，而直接创建和关联对象的代码风格。OLOO十分自然地实现了基于[[Prototype]]的行为委托。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">weihome</p>
              <p class="site-description motion-element" itemprop="description">博客 前端 前端开发</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">weihome</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
