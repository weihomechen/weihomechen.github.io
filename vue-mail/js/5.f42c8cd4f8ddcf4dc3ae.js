webpackJsonp([5],{318:function(t,e,i){function n(t){i(510)}var s=i(2)(i(407),i(556),n,null,null);t.exports=s.exports},407:function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var s=i(411),a=n(s),r=i(114),l=n(r),o=i(115),c=i(9);e.default={name:"outbox",data:function(){return{list:null,total:null,listLoading:!0,listQuery:{page:1,limit:20,title:void 0,receciveName:void 0,receciveMail:void 0,sort:"",order:""},multipleSelection:[],tableKey:0,labelList:[]}},created:function(){this.initPage()},filters:{showReceiveName:function(t){var e="";return t.forEach(function(t){return e+=t.name+";"}),e}},methods:{initPage:function(){this.getList(),this.getLabelList()},getList:function(){var t=this;this.listLoading=!0,a.fetchList(this.listQuery).then(function(e){t.list=e.data.items,t.total=e.data.total,t.listLoading=!1})},getLabelList:function(){var t=this;l.fetchList().then(function(e){t.labelList=e.data.labelList})},handleFilter:function(){this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},customSort:function(t){this.listQuery.sort=t.prop,this.listQuery.order=t.order,this.getList()},timeFilter:function(t){if(!t[0])return this.listQuery.start=void 0,void(this.listQuery.end=void 0);this.listQuery.start=parseInt(+t[0]/1e3),this.listQuery.end=parseInt((+t[1]+864e5)/1e3)},goToDetail:function(t){this.$store.commit("SET_MAIL_ID",t),this.$store.commit("SET_MAIL_TYPE","send"),this.$router.push({path:"/mail_detail/index"})},edit:function(){if(1!==(this.multipleSelection.length||0))return void this.$message("请选择一封邮件进行编辑");this.$store.commit("SET_MAIL_ID",this.multipleSelection[0].id),this.$store.commit("SET_PAGE_TYPE","edit"),this.$store.commit("SET_MAIL_TYPE","send"),this.$router.push({path:"/mail_send/index"})},forward:function(){if(1!==(this.multipleSelection.length||0))return void this.$message("请选择一封邮件进行转发");this.$store.commit("SET_MAIL_ID",this.multipleSelection[0].id),this.$store.commit("SET_PAGE_TYPE","forward"),this.$store.commit("SET_MAIL_TYPE","send"),this.$router.push({path:"/mail_send/index"})},handleSelectionChange:function(t){this.multipleSelection=t},handleDelete:function(){var t=this,e=this.multipleSelection.length||0;if(e<1)return void this.$message("请选择邮件进行删除");this.$confirm("是否删除这"+e+"封邮件?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.multipleSelection.forEach(function(t){return e.push(t.id)}),a.delSendMail(e).subscribe({next:function(){t.$message({message:"删除成功",type:"success",duration:2e3}),t.getList()},error:function(){return t.$message({showClose:!0,message:"删除失败",type:"error"})}})}).catch(function(){t.$message("操作已取消")})},handleDownload:function(){var t=this;i.e(19).then(function(){var e=i(334),n=e.export_json_to_excel,s=["收件人","主题","发送时间"],a=["receiveList","title","sendDate"];n(s,t.formatJson(a,t.list),(0,c.parseTime)(Date.now())+"发件箱数据")}.bind(null,i)).catch(i.oe)},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){if(~t.indexOf("Date"))return(0,c.parseTime)(e[t]);if("Array"===(0,o.getType)(e[t])){var i="";return e[t].forEach(function(t){return i+=t.name+"<"+t.mail+">;"}),i}return e[t]})})},toggleStar:function(t){var e=this,i=[];if(t)i.push(t.id);else{if((this.multipleSelection.length||0)<1)return void this.$message("请选择邮件进行标记");this.multipleSelection.forEach(function(t){return i.push(t.id)})}l.toggleStar(i).subscribe({next:function(){t?t.isStar=!t.isStar:e.multipleSelection.forEach(function(t){return t.isStar=!0})}})},handleMark:function(t){var e=this;if("star"===t)this.toggleStar();else{if((this.multipleSelection.length||0)<1)return void this.$message("请选择邮件进行标记");var i=[];this.multipleSelection.forEach(function(t){return i.push(t.id)}),l.markLabel(t,i).subscribe({next:function(){return e.getList()}})}}}}},411:function(t,e,i){"use strict";function n(t){return(0,r.default)({url:"/outbox/list",method:"get",params:t})}function s(t){var e=String(t);return console.log("要删除的发件id:"+e),l.Observable.create(function(t){setTimeout(function(){t.next(!0)},1e3)})}Object.defineProperty(e,"__esModule",{value:!0}),e.fetchList=n,e.delSendMail=s;var a=i(35),r=function(t){return t&&t.__esModule?t:{default:t}}(a),l=i(64)},428:function(t,e,i){e=t.exports=i(300)(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"index.vue",sourceRoot:""}])},510:function(t,e,i){var n=i(428);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i(301)("cd47c988",n,!0)},556:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container calendar-list-container"},[i("div",{staticClass:"filter-container"},[i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-edit",attrs:{type:"primary",icon:"edit"},on:{click:t.edit}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-forward",attrs:{type:"primary",icon:"share"},on:{click:t.forward}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-del",attrs:{type:"danger",icon:"delete"},on:{click:function(e){t.handleDelete()}}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-reload",attrs:{type:"primary"},on:{click:t.initPage}},[i("icon-svg",{attrs:{"icon-class":"reload4"}})],1),t._v(" "),i("el-dropdown",{staticClass:"tool-item filter-item",attrs:{"split-button":"",type:"primary","menu-align":"start"},on:{command:t.handleMark}},[t._v("\n            标记为\n            "),i("el-dropdown-menu",{slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"star"}},[i("icon-svg",{staticClass:"download-icon",attrs:{"icon-class":"favourite"}}),t._v("星标邮件")],1),t._v(" "),t._l(t.labelList,function(e){return i("el-dropdown-item",{key:e.id,attrs:{command:e.id+""}},[i("icon-svg",{staticClass:"download-icon",attrs:{"icon-class":"label1"}}),t._v(t._s(e.name))],1)})],2)],1),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"300px"},attrs:{placeholder:"标题"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.handleFilter(e)}},model:{value:t.listQuery.title,callback:function(e){t.listQuery.title=e},expression:"listQuery.title"}}),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"收件人"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.handleFilter(e)}},model:{value:t.listQuery.receiveName,callback:function(e){t.listQuery.receiveName=e},expression:"listQuery.receiveName"}}),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"150px"},attrs:{placeholder:"收件邮箱"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.handleFilter(e)}},model:{value:t.listQuery.receiveMail,callback:function(e){t.listQuery.receiveMail=e},expression:"listQuery.receiveMail"}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"search"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"text",icon:"document"},on:{click:t.handleDownload}},[t._v("导出")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],key:t.tableKey,ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.list,border:"","highlight-current-row":""},on:{"sort-change":t.customSort,"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection","min-width":"30px"}}),t._v(" "),i("el-table-column",{attrs:{align:"left",width:"90px",label:"信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("icon-svg",{staticClass:"star",attrs:{"icon-class":e.row.isStar?"favourite":"favourite-o"},nativeOn:{click:function(i){t.toggleStar(e.row)}}}),t._v(" "),e.row.isHaveFile?i("icon-svg",{staticClass:"file",attrs:{"icon-class":"label4"}}):t._e(),t._v(" "),e.row.isHaveAudio?i("icon-svg",{attrs:{"icon-class":"voice4"}}):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"收件人",width:"120px","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(t._f("showReceiveName")(e.row.receiveList)))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"title",sortable:"custom",label:"主题","show-overflow-tooltip":!0,"min-width":"400px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"link-type",on:{click:function(i){t.goToDetail(e.row.id)}}},[t._v(t._s(e.row.title))]),t._v(" "),t._l(e.row.labelList,function(e){return i("el-tag",{key:e.guid},[t._v(t._s(e.name))])})]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"sendDate",sortable:"custom",align:"center",label:"发送时间",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(t._f("parseTime")(e.row.sendDate,"{y}-{m}-{d} {h}:{i}")))])]}}])})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.listLoading,expression:"!listLoading"}],staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.listQuery.page=e}}})],1)],1)},staticRenderFns:[]}}});
//# sourceMappingURL=5.f42c8cd4f8ddcf4dc3ae.js.map