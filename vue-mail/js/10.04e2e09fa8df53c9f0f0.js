webpackJsonp([10],{310:function(t,e,i){function a(t){i(548)}var n=i(1)(i(423),i(595),a,null,null);t.exports=n.exports},423:function(t,e,i){"use strict";function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var n=i(438),s=a(n),l=i(117),o=a(l),r=i(118),c=i(10);e.default={name:"draftbox",data:function(){return{list:null,total:null,listLoading:!0,listQuery:{page:1,limit:20,title:"",startCreatDate:null,stopCreateDate:null,startModifyDate:null,stopModifyDate:null,sort:"",order:""},multipleSelection:[],tableKey:0,labelList:[],createDateRange:[],lastModifyDateRange:[],dateOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-6048e5),t.$emit("pick",[i,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-2592e6),t.$emit("pick",[i,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,i=new Date;i.setTime(i.getTime()-7776e6),t.$emit("pick",[i,e])}}]}}},created:function(){this.initPage()},filters:{showReceiveName:function(t){var e="";return t.forEach(function(t){return e+=t.name+";"}),e}},methods:{initPage:function(){this.getList(),this.getLabelList()},getList:function(){var t=this;this.listLoading=!0,this.listQuery.startCreateDate=this.createDateRange[0]?this.createDateRange[0].getTime():null,this.listQuery.stopCreateDate=this.createDateRange[1]?this.createDateRange[1].getTime():null,this.listQuery.startModifyDate=this.lastModifyDateRange[0]?this.lastModifyDateRange[0].getTime():null,this.listQuery.stopModifyDate=this.lastModifyDateRange[1]?this.lastModifyDateRange[1].getTime():null,s.fetchList(this.listQuery).then(function(e){t.list=e.data.items,t.total=e.data.total,t.listLoading=!1})},getLabelList:function(){var t=this;o.fetchList().then(function(e){t.labelList=e.data.labelList})},handleFilter:function(){this.getList()},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},customSort:function(t){this.listQuery.sort=t.prop,this.listQuery.order=t.order,this.getList()},timeFilter:function(t){if(!t[0])return this.listQuery.start=void 0,void(this.listQuery.end=void 0);this.listQuery.start=parseInt(+t[0]/1e3),this.listQuery.end=parseInt((+t[1]+864e5)/1e3)},goToDetail:function(t){this.$store.commit("SET_DRAFT_ID",t),this.$store.commit("SET_MAIL_ID",null),this.$store.commit("SET_PAGE_TYPE","edit"),this.$store.commit("SET_MAIL_TYPE","draft"),this.$router.push({path:"/mail_send/index"})},handleSelectionChange:function(t){this.multipleSelection=t},handleDelete:function(){var t=this,e=this.multipleSelection.length||0;if(e<1)return void this.$message("请选择草稿进行删除");this.$confirm("是否删除这"+e+"封草稿?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=[];t.multipleSelection.forEach(function(t){return e.push(t.id)}),s.delSendMail(e).subscribe({next:function(){t.$message({message:"删除成功",type:"success",duration:2e3}),t.getList()},error:function(){return t.$message({showClose:!0,message:"删除失败",type:"error"})}})}).catch(function(){t.$message("操作已取消")})},handleDownload:function(){var t=this;i.e(19).then(function(){var e=i(347),a=e.export_json_to_excel,n=["收件人","主题","创建时间","最后修改时间"],s=["receiveList","title","createDate","lastmodifyDate"];a(n,t.formatJson(s,t.list),(0,c.parseTime)(Date.now())+"草稿箱数据")}.bind(null,i)).catch(i.oe)},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){if(~t.indexOf("Date"))return(0,c.parseTime)(e[t]);if("Array"===(0,r.getType)(e[t])){var i="";return e[t].forEach(function(t){return i+=t.name+"<"+t.mail+">;"}),i}return e[t]})})},toggleStar:function(t){var e=this,i=[];if(t)i.push(t.id);else{if((this.multipleSelection.length||0)<1)return void this.$message("请选择邮件进行标记");this.multipleSelection.forEach(function(t){return i.push(t.id)})}o.toggleStar(i).subscribe({next:function(){t?t.isStar=!t.isStar:e.multipleSelection.forEach(function(t){return t.isStar=!0})}})},handleMark:function(t){var e=this;if("star"===t)this.toggleStar();else{if((this.multipleSelection.length||0)<1)return void this.$message("请选择邮件进行标记");var i=[];this.multipleSelection.forEach(function(t){return i.push(t.id)}),o.markLabel(t,i).subscribe({next:function(){return e.getList()}})}}}}},438:function(t,e,i){"use strict";function a(t){return(0,l.default)({url:"/draftbox/list",method:"get",params:t})}function n(t){var e=String(t);return console.log("要删除的草稿id:"+e),o.Observable.create(function(t){setTimeout(function(){t.next(!0)},1e3)})}Object.defineProperty(e,"__esModule",{value:!0}),e.fetchList=a,e.delDraft=n;var s=i(38),l=function(t){return t&&t.__esModule?t:{default:t}}(s),o=i(64)},466:function(t,e,i){e=t.exports=i(307)(!0),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"index.vue",sourceRoot:""}])},548:function(t,e,i){var a=i(466);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(308)("f3eb9e02",a,!0)},595:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container calendar-list-container"},[i("div",{staticClass:"filter-container"},[i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-del",attrs:{type:"danger",icon:"delete"},on:{click:function(e){t.handleDelete()}}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"tool-item filter-item btn-reload",attrs:{type:"primary"},on:{click:t.initPage}},[i("icon-svg",{attrs:{"icon-class":"reload4"}})],1),t._v(" "),i("el-dropdown",{staticClass:"tool-item filter-item",attrs:{"split-button":"",type:"primary","menu-align":"start"},on:{command:t.handleMark}},[t._v("\n            标记为\n            "),i("el-dropdown-menu",{slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"star"}},[i("icon-svg",{staticClass:"download-icon",attrs:{"icon-class":"favourite"}}),t._v("星标邮件")],1),t._v(" "),t._l(t.labelList,function(e){return i("el-dropdown-item",{key:e.id,attrs:{command:e.id+""}},[i("icon-svg",{staticClass:"download-icon",attrs:{"icon-class":"label1"}}),t._v(t._s(e.name))],1)})],2)],1),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"300px"},attrs:{placeholder:"标题"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13))return null;t.handleFilter(e)}},model:{value:t.listQuery.title,callback:function(e){t.listQuery.title=e},expression:"listQuery.title"}}),t._v(" "),i("el-date-picker",{staticClass:"tool-item filter-item",staticStyle:{width:"200px"},attrs:{type:"datetimerange","picker-options":t.dateOptions,placeholder:"创建时间",align:"right"},model:{value:t.createDateRange,callback:function(e){t.createDateRange=e},expression:"createDateRange"}}),t._v(" "),i("el-date-picker",{staticClass:"tool-item filter-item",staticStyle:{width:"200px"},attrs:{type:"datetimerange","picker-options":t.dateOptions,placeholder:"最后修改时间",align:"right"},model:{value:t.lastModifyDateRange,callback:function(e){t.lastModifyDateRange=e},expression:"lastModifyDateRange"}}),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"search"},on:{click:t.handleFilter}},[t._v("搜索")]),t._v(" "),i("el-button",{staticClass:"filter-item",attrs:{type:"text",icon:"document"},on:{click:t.handleDownload}},[t._v("导出")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading.body",value:t.listLoading,expression:"listLoading",modifiers:{body:!0}}],key:t.tableKey,ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.list,border:"","highlight-current-row":""},on:{"sort-change":t.customSort,"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection","min-width":"30px"}}),t._v(" "),i("el-table-column",{attrs:{align:"left",width:"90px",label:"信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("icon-svg",{staticClass:"star",attrs:{"icon-class":e.row.isStar?"favourite":"favourite-o"},nativeOn:{click:function(i){t.toggleStar(e.row)}}}),t._v(" "),e.row.isHaveFile?i("icon-svg",{staticClass:"file",attrs:{"icon-class":"label4"}}):t._e(),t._v(" "),e.row.isHaveAudio?i("icon-svg",{attrs:{"icon-class":"voice4"}}):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"收件人",width:"120px","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(t._f("showReceiveName")(e.row.receiveList)))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"title",sortable:"custom",label:"主题","show-overflow-tooltip":!0,"min-width":"400px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"link-type",on:{click:function(i){t.goToDetail(e.row.id)}}},[t._v(t._s(e.row.title))]),t._v(" "),t._l(e.row.labelList,function(e){return i("el-tag",{key:e.guid},[t._v(t._s(e.name))])})]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"createDate",sortable:"custom",align:"center",label:"创建时间",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(t._f("parseTime")(e.row.createDate,"{y}-{m}-{d} {h}:{i}")))])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"lastModifyDate",sortable:"custom",align:"center",label:"最后修改时间",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(t._f("parseTime")(e.row.lastModifyDate,"{y}-{m}-{d} {h}:{i}")))])]}}])})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.listLoading,expression:"!listLoading"}],staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.listQuery.page=e}}})],1)],1)},staticRenderFns:[]}}});